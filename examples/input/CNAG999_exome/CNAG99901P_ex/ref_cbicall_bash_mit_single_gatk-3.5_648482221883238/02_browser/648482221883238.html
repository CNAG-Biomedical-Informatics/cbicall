<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BFF Browser - mtDNA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/jsD/media/css/jquery.dataTables.css">
    <link rel="stylesheet" href="assets/jsD/media/css/dataTables.colReorder.css">
    <link rel="stylesheet" href="assets/jsD/media/css/dataTables.colVis.css">
    <link rel="stylesheet" href="assets/jsD/media/css/dataTables.tableTools.css">

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/jsD/media/js/jquery.dataTables.min.js"></script>
    <script src="assets/jsD/media/js/dataTables.colReorder.js"></script>
    <script src="assets/jsD/media/js/dataTables.colVis.js"></script>
    <script src="assets/jsD/media/js/dataTables.tableTools.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {

      var diseaseThreshold = 0.80;

      // FILTER: keep variants with ANY supporting evidence
      $.fn.dataTableExt.afnFiltering.push(
        function(oSettings, aData, iDataIndex) {

          if (oSettings.nTable.getAttribute('id') !== 'table-panel-mtdna') {
            return true;
          }
          if (!$('#toggle-candidates').prop('checked')) {
            return true;
          }

          // Columns:
          // 12 Mitomap
          // 15 ClinVar
          // 16 OMIM
          // 17 dbSNP
          var mitomap = (aData[12] || "").replace(/<[^>]*>/g, '').trim();
          var clinvar = (aData[15] || "").replace(/<[^>]*>/g, '').trim();
          var omim    = (aData[16] || "").replace(/<[^>]*>/g, '').trim();
          var dbsnp   = (aData[17] || "").replace(/<[^>]*>/g, '').trim();

          if (mitomap || clinvar || omim || dbsnp)
            return true;

          return false;
        }
      );

      // DATATABLE
      var table = $('#table-panel-mtdna').dataTable({
        "ajax": {
          "url": "mit.json",
          "dataSrc": "data"
        },
        "bDeferRender": true,
        "stateSave": true,
        "order": [[ 8, "desc" ]],
        "search": { "regex": true },

        "language": {
          "sSearch": '<span class="icon-search"></span>',
          "lengthMenu": "Show _MENU_ variants",
          "sInfo": "Showing _START_ to _END_ of _TOTAL_ variants",
          "sInfoFiltered": " (filtered from _MAX_ variants)"
        },

        "aoColumnDefs": [
          { "aTargets": [9,11,18,13,14,20,21], "bVisible": false },

          {
            "aTargets": [10], /* Disease Score */
            "fnCreatedCell": function(td, cellData) {
              var val = parseFloat(String(cellData).replace(/<[^>]*>/g,''));
              if (!isNaN(val) && val >= diseaseThreshold)
                $(td).css('background-color','#f9d2d2');
            }
          },

          {
            "aTargets": [12], /* Mitomap */
            "fnCreatedCell": function(td, cellData) {
              var txt = String(cellData).replace(/<[^>]*>/g,'').trim();
              if (txt.length > 0)
                $(td).css('background-color','#f9d2d2');
            }
          }
        ],

        "dom": 'CRT<"clear">lfrtip',
        "colVis": {
          "showAll": "Show all",
          "showNone": "Show none"
        },
        "tableTools": {
          "aButtons": [
            {
              "sExtends": "print",
              "sButtonText": '<span class="icon-print"></span>'
            }
          ]
        },

        "orderCellsTop": true
      });


      // PER-COLUMN FILTERS
      $('#table-panel-mtdna thead tr:eq(1) th').each(function(i) {
        if (i === 1 || i === 10 || i === 15 || i === 17) {
          $(this).html(
            '<input type="text" placeholder="Filter" ' +
            'style="width:100%; box-sizing:border-box; font-size:10px;" />'
          );
        }
      });

      $('#table-panel-mtdna thead tr:eq(1) th input').on('keyup change', function() {
        var index = $(this).parent().index();
        table.fnFilter(this.value, index);
      });

      $('#toggle-candidates').on('change', function() {
        table.fnDraw();
      });

    });
    </script>

  </head>
  <body class="dt-example">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">BFF Browser - mtDNA</a>
        </div>
      </div>
    </div>

    <div class="container">
      <a class="btn pull-right" href="../01_mtoolbox/mit_prioritized_variants.txt"><i class="icon-download"></i> REPORT</a>
      <a class="btn pull-right" href="../01_mtoolbox/mt_classification_best_results.csv"><i class="icon-download"></i> HAPLOg</a>
      <a class="btn pull-right" href="../01_mtoolbox/VCF_file.vcf"><i class="icon-download"></i> VCF</a>
      <a class="btn pull-right" href="./../01_mtoolbox/mit.raw.json"><i class="icon-download"></i> mtDNA JSON</a>

      <h4>Project &#9658; CNAG99901P</h4>
      <h3>Job ID &#9658; 648482221883238 &#9658; mtDNA_prioritized_variants</h3>

      <label class="checkbox">
        <input type="checkbox" id="toggle-candidates">
        Show only candidate variants (Mitomap OR ClinVar OR OMIM OR dbSNP)
      </label>

      <ul class="nav nav-tabs">
        <li class="active"><a href="#tab-panel-mtdna" data-toggle="tab">mtDNA variants</a></li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade in active" id="tab-panel-mtdna">
          <table id="table-panel-mtdna" class="display table table-hover table-condensed">
            <thead>
              <tr>
                <th>Sample</th><th>Locus</th><th>Variant_Allele</th><th>Ref</th>
                <th>Alt</th><th>Aa_Change</th><th>GT</th><th>Depth</th>
                <th>Heterop_Frac</th><th>tRNA_Annotation</th><th>Disease_Score</th>
                <th>RNA_predictions</th><th>Mitomap_Associated_Disease(s)</th>
                <th>Mitomap_Homoplasmy</th><th>Mitomap_Heteroplasmy</th><th>ClinVar</th>
                <th>OMIM_link</th><th>dbSNP_ID</th><th>Mamit-tRNA_link</th>
                <th>AC/AN_1000G</th><th>1000G_Homoplasmy</th><th>1000G_Heteroplasmy</th>
              </tr>
              <tr>
                <th></th><th></th><th></th><th></th><th></th>
                <th></th><th></th><th></th><th></th><th></th>
                <th></th><th></th><th></th><th></th><th></th>
                <th></th><th></th><th></th><th></th><th></th>
                <th></th><th></th>
              </tr>
            </thead>
          </table>
        </div>
      </div>

      <footer><p>&copy; 2021â€“2025 CNAG | Barcelona</p></footer>
    </div>
  </body>
</html>
