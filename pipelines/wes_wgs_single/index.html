
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="CBIcall: CNAG Biomedical Informatics framework for variant Calling" name="description"/>
<meta content="Manuel Rueda, PhD" name="author"/>
<link href="../../usage/usage/" rel="prev"/>
<link href="../wes_wgs_cohort/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>üî¨ WES WGS Single - CBIcall Documentation</title>
<link href="../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../css/theme_overrides.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="amber" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#diagram-single-sample-weswgs-workflow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="CBIcall Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="CBIcall Documentation">
<img alt="logo" src="../../img/cbicall-logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            CBIcall Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              üî¨ WES WGS Single
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/CNAG-Biomedical-Informatics/cbicall" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg>
</div>
<div class="md-source__repository">
    CBIcall
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="CBIcall Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="CBIcall Documentation">
<img alt="logo" src="../../img/cbicall-logo.png"/>
</a>
    CBIcall Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/CNAG-Biomedical-Informatics/cbicall" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg>
</div>
<div class="md-source__repository">
    CBIcall
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    
  
    üè† Home
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-ellipsis">
    
  
    ‚¨áÔ∏è Installation
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    ‚¨áÔ∏è Installation
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../installation/non-containerized/">
<span class="md-ellipsis">
    
  
    üõ†Ô∏è Non-containerized
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../installation/docker/">
<span class="md-ellipsis">
    
  
    üê≥ Docker
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    
  
    üöÄ Getting Started
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    üöÄ Getting Started
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/quickstart/">
<span class="md-ellipsis">
    
  
    ‚ö° Quickstart
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/end-to-end-example-wes/">
<span class="md-ellipsis">
    
  
    üß™ End-to-end Example (WES)
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/end-to-end-example-mit/">
<span class="md-ellipsis">
    
  
    üß¨ End-to-end Example (mtDNA)
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../usage/usage/">
<span class="md-ellipsis">
    
  
    üìò General Usage
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    üß™ Pipelines
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    üß™ Pipelines
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    üî¨ WES WGS Single
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    üî¨ WES WGS Single
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#diagram-single-sample-weswgs-workflow">
<span class="md-ellipsis">
      
        Diagram: Single-Sample WES/WGS Workflow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#purpose">
<span class="md-ellipsis">
      
        Purpose
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-the-pipeline-does">
<span class="md-ellipsis">
      
        What the Pipeline Does
      
    </span>
</a>
<nav aria-label="What the Pipeline Does" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-alignment-read-groups">
<span class="md-ellipsis">
      
        1. Alignment &amp; Read Groups
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-lane-merging">
<span class="md-ellipsis">
      
        2. Lane Merging
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-duplicate-marking">
<span class="md-ellipsis">
      
        3. Duplicate Marking
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-base-quality-score-recalibration-bqsr">
<span class="md-ellipsis">
      
        4. Base Quality Score Recalibration (BQSR)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-variant-calling-haplotypecaller-gvcf">
<span class="md-ellipsis">
      
        5. Variant Calling (HaplotypeCaller, gVCF)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-genotypegvcfs-raw-vcf">
<span class="md-ellipsis">
      
        6. GenotypeGVCFs (Raw VCF)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-variant-quality-score-recalibration-vqsr">
<span class="md-ellipsis">
      
        7. Variant Quality Score Recalibration (VQSR)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-apply-vqsr-or-hard-filters">
<span class="md-ellipsis">
      
        8. Apply VQSR or Hard Filters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-generate-final-qc-vcf">
<span class="md-ellipsis">
      
        9. Generate Final QC VCF
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10-coverage-sex-determination">
<span class="md-ellipsis">
      
        10. Coverage &amp; Sex Determination
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#output-files">
<span class="md-ellipsis">
      
        Output Files
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#when-to-use-this-pipeline">
<span class="md-ellipsis">
      
        When to Use This Pipeline
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../wes_wgs_cohort/">
<span class="md-ellipsis">
    
  
    üß´ WES WGS Cohort
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mtdna/">
<span class="md-ellipsis">
    
  
    üß¨ mtDNA
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
<span class="md-ellipsis">
    
  
    üîß Technical Details
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    üîß Technical Details
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../technical-details/architecture/">
<span class="md-ellipsis">
    
  
    üèóÔ∏è Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../technical-details/adding-a-pipeline/">
<span class="md-ellipsis">
    
  
    üß± Adding a Pipeline
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    
  
    ‚ùì Help &amp; Reference
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            
  
    ‚ùì Help &amp; Reference
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../help/naming-conventions/">
<span class="md-ellipsis">
    
  
    üè∑Ô∏è Naming Conventions
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../help/performance/">
<span class="md-ellipsis">
    
  
    ‚öôÔ∏è Performance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../help/troubleshooting/">
<span class="md-ellipsis">
    
  
    üêõ Troubleshooting
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../help/faq/">
<span class="md-ellipsis">
    
  
    ü§î FAQ
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-ellipsis">
    
  
    ‚ÑπÔ∏è About
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            
  
    ‚ÑπÔ∏è About
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/about/">
<span class="md-ellipsis">
    
  
    üë§ About
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/citation/">
<span class="md-ellipsis">
    
  
    üìÑ Citation
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="weswgs-single-sample-pipeline">WES/WGS Single-Sample Pipeline<a class="headerlink" href="#weswgs-single-sample-pipeline" title="Permanent link">¬∂</a></h1>
<p>A user-focused guide to processing whole-exome (WES) and whole-genome (WGS) data using GATK Best Practices.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Bash</label><label for="__tabbed_1_2">Snakemake</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<details class="example">
<summary>See Bash pipeline:</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="ch">#!/usr/bin/env bash</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="c1">#</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="c1">#   WGS/WES pipeline Bash script (GATK4.6 best-practices edition).</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1">#   Last Modified: 2025-05-02</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c1">#</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="c1"># README:</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1">#   This script runs either WES or WGS pipelines based on the '-p' mode flag.</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="c1">#   Mode 'wes': uses provided exome interval list to restrict variant calling.</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="c1">#   Mode 'wgs': processes the entire genome (no intervals).</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1">#   Common steps (GATK Best Practices):</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="c1">#     1) Align &amp; add read groups</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="c1">#     2) Merge lane-level BAMs</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="c1">#     3) Mark duplicates</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="c1">#     4) Base Quality Score Recalibration (BQSR)</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="c1">#     5) HaplotypeCaller (per-sample gVCF)</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="c1">#     6) GenotypeGVCFs (raw VCF)</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="c1">#     7) VariantRecalibrator (VQSR) if variant counts suffice</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c1">#     8) Apply VQSR models or fallback to hard filters</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="c1">#     9) Hard-filter &amp; write QC VCF</span>
</span><span id="__span-0-20"><a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="c1">#    10) Coverage stats &amp; sex determination</span>
</span><span id="__span-0-21"><a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="nb">set</span><span class="w"> </span>-eu
</span><span id="__span-0-23"><a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="nv">CLEANUP_BAM</span><span class="o">=</span><span class="nb">false</span>
</span><span id="__span-0-25"><a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>
</span><span id="__span-0-26"><a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">function</span><span class="w"> </span>usage<span class="w"> </span><span class="o">{</span>
</span><span id="__span-0-27"><a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-0-28"><a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="s">Usage: $0 -t &lt;n_threads&gt; -p &lt;wes|wgs&gt; [-c]</span>
</span><span id="__span-0-29"><a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="s">  -t, --threads         Number of CPU threads for GATK tools</span>
</span><span id="__span-0-31"><a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="s">  -p, --pipeline        Pipeline mode: 'wes' or 'wgs'</span>
</span><span id="__span-0-32"><a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="s">  -c, --cleanup-bam     If set, delete all 01_bam/*.bam when done (default: off)</span>
</span><span id="__span-0-33"><a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="s">EOF</span>
</span><span id="__span-0-34"><a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-35"><a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="o">}</span>
</span><span id="__span-0-36"><a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>
</span><span id="__span-0-37"><a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="c1"># Parse command-line arguments</span>
</span><span id="__span-0-38"><a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-0-39"><a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="w"> </span><span class="k">in</span>
</span><span id="__span-0-40"><a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span>-t<span class="p">|</span>--threads<span class="o">)</span>
</span><span id="__span-0-41"><a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">      </span><span class="nv">THREADS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
</span><span id="__span-0-42"><a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">      </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-0-43"><a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">      </span><span class="p">;;</span>
</span><span id="__span-0-44"><a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span>-p<span class="p">|</span>--pipeline<span class="o">)</span>
</span><span id="__span-0-45"><a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">      </span><span class="nv">PIPELINE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
</span><span id="__span-0-46"><a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">      </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>
</span><span id="__span-0-47"><a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">      </span><span class="p">;;</span>
</span><span id="__span-0-48"><a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span>-c<span class="p">|</span>--cleanup-bam<span class="o">)</span>
</span><span id="__span-0-49"><a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">      </span><span class="nv">CLEANUP_BAM</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-0-50"><a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">      </span><span class="nb">shift</span>
</span><span id="__span-0-51"><a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">      </span><span class="p">;;</span>
</span><span id="__span-0-52"><a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span>*<span class="o">)</span>
</span><span id="__span-0-53"><a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">      </span>usage
</span><span id="__span-0-54"><a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">      </span><span class="p">;;</span>
</span><span id="__span-0-55"><a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">  </span><span class="k">esac</span>
</span><span id="__span-0-56"><a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="k">done</span>
</span><span id="__span-0-57"><a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="c1"># make sure the required ones really got set</span>
</span><span id="__span-0-59"><a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">THREADS</span><span class="k">:-</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">PIPELINE</span><span class="k">:-</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-60"><a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">  </span>usage
</span><span id="__span-0-61"><a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">fi</span>
</span><span id="__span-0-62"><a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="c1"># Convert to Uppercase</span>
</span><span id="__span-0-64"><a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="nv">PIPELINE</span><span class="o">=</span><span class="si">${</span><span class="nv">PIPELINE</span><span class="p">^^</span><span class="si">}</span>
</span><span id="__span-0-65"><a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$PIPELINE</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"WES"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">"</span><span class="nv">$PIPELINE</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"WGS"</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-66"><a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Error: Mode must be 'wes' or 'wgs'."</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</span><span id="__span-0-67"><a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">  </span>usage
</span><span id="__span-0-68"><a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">fi</span>
</span><span id="__span-0-69"><a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="c1"># Load GATK parameters (reference, known-sites, interval list, tool paths)</span>
</span><span id="__span-0-71"><a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="nv">BINDIR</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">"</span>
</span><span id="__span-0-72"><a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="nb">source</span><span class="w"> </span><span class="s2">"</span><span class="nv">$BINDIR</span><span class="s2">/parameters.sh"</span>
</span><span id="__span-0-73"><a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a>
</span><span id="__span-0-74"><a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="c1"># Prepare output directories</span>
</span><span id="__span-0-75"><a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="nv">dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</span><span id="__span-0-76"><a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="nv">BAMDIR</span><span class="o">=</span><span class="nv">$dir</span>/01_bam
</span><span id="__span-0-77"><a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="nv">VARCALLDIR</span><span class="o">=</span><span class="nv">$dir</span>/02_varcall
</span><span id="__span-0-78"><a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="nv">STATSDIR</span><span class="o">=</span><span class="nv">$dir</span>/03_stats
</span><span id="__span-0-79"><a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="nv">LOGDIR</span><span class="o">=</span><span class="nv">$dir</span>/logs
</span><span id="__span-0-80"><a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$STATSDIR</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$LOGDIR</span><span class="s2">"</span>
</span><span id="__span-0-81"><a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="c1"># Determine sample ID &amp; log file</span>
</span><span id="__span-0-83"><a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="nv">rawid</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">"</span><span class="nv">$PWD</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span><span class="k">)</span>
</span><span id="__span-0-84"><a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="nv">id</span><span class="o">=</span><span class="si">${</span><span class="nv">rawid</span><span class="p">%%_*</span><span class="si">}</span>
</span><span id="__span-0-85"><a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="nv">LOG</span><span class="o">=</span><span class="nv">$LOGDIR</span>/<span class="si">${</span><span class="nv">id</span><span class="si">}</span>.log
</span><span id="__span-0-86"><a href="#__codelineno-0-86" id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a href="#__codelineno-0-87" id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="c1"># Set interval argument for WES vs WGS</span>
</span><span id="__span-0-88"><a href="#__codelineno-0-88" id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$PIPELINE</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"WES"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-89"><a href="#__codelineno-0-89" id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">  </span><span class="nv">INTERVAL_ARG</span><span class="o">=</span><span class="s2">"-L </span><span class="nv">$INTERVAL_LIST</span><span class="s2">"</span>
</span><span id="__span-0-90"><a href="#__codelineno-0-90" id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"WES mode: restricting to </span><span class="nv">$INTERVAL_LIST</span><span class="s2">"</span>
</span><span id="__span-0-91"><a href="#__codelineno-0-91" id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">else</span>
</span><span id="__span-0-92"><a href="#__codelineno-0-92" id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">  </span><span class="nv">INTERVAL_ARG</span><span class="o">=</span><span class="s2">""</span>
</span><span id="__span-0-93"><a href="#__codelineno-0-93" id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"WGS mode: processing whole genome"</span>
</span><span id="__span-0-94"><a href="#__codelineno-0-94" id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">fi</span>
</span><span id="__span-0-95"><a href="#__codelineno-0-95" id="__codelineno-0-95" name="__codelineno-0-95"></a>
</span><span id="__span-0-96"><a href="#__codelineno-0-96" id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-97"><a href="#__codelineno-0-97" id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="c1"># STEP 1: Align &amp; Add Read Groups (per-lane BAMs)</span>
</span><span id="__span-0-98"><a href="#__codelineno-0-98" id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="c1"># Theory: Read groups are required for GATK to tag sample, library, and platform</span>
</span><span id="__span-0-99"><a href="#__codelineno-0-99" id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="c1"># information, enabling per-sample metrics and proper handling of multi-library data.</span>
</span><span id="__span-0-100"><a href="#__codelineno-0-100" id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-101"><a href="#__codelineno-0-101" id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 1: Align &amp; add read groups"</span>
</span><span id="__span-0-102"><a href="#__codelineno-0-102" id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">for</span><span class="w"> </span>R1<span class="w"> </span><span class="k">in</span><span class="w"> </span>../*_R1_*fastq.gz<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-0-103"><a href="#__codelineno-0-103" id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">  </span><span class="nv">fn</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">"</span><span class="nv">$R1</span><span class="s2">"</span><span class="w"> </span>.fastq.gz<span class="k">)</span>
</span><span id="__span-0-104"><a href="#__codelineno-0-104" id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">  </span><span class="nv">base</span><span class="o">=</span><span class="si">${</span><span class="nv">fn</span><span class="p">%_R1*</span><span class="si">}</span>
</span><span id="__span-0-105"><a href="#__codelineno-0-105" id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">  </span><span class="nv">R2</span><span class="o">=</span><span class="si">${</span><span class="nv">R1</span><span class="p">/_R1_/_R2_</span><span class="si">}</span>
</span><span id="__span-0-106"><a href="#__codelineno-0-106" id="__codelineno-0-106" name="__codelineno-0-106"></a>
</span><span id="__span-0-107"><a href="#__codelineno-0-107" id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">  </span><span class="nv">SAMPLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">'_'</span><span class="w"> </span>-f1-2<span class="k">)</span>
</span><span id="__span-0-108"><a href="#__codelineno-0-108" id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">  </span><span class="nv">LANE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w">   </span><span class="s2">"</span><span class="nv">$base</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">'_'</span><span class="w"> </span>-f3<span class="k">)</span>
</span><span id="__span-0-109"><a href="#__codelineno-0-109" id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">  </span><span class="c1"># ensure RGIDs are unique by appending a timestamp</span>
</span><span id="__span-0-110"><a href="#__codelineno-0-110" id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">  </span><span class="nv">RGID</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">SAMPLE</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">LANE</span><span class="si">}</span><span class="s2">.</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-0-111"><a href="#__codelineno-0-111" id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="w">  </span><span class="nv">RGPU</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">SAMPLE</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">LANE</span><span class="si">}</span><span class="s2">.unit1"</span>
</span><span id="__span-0-112"><a href="#__codelineno-0-112" id="__codelineno-0-112" name="__codelineno-0-112"></a>
</span><span id="__span-0-113"><a href="#__codelineno-0-113" id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="w">  </span><span class="nv">out_bam</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">base</span><span class="si">}</span><span class="s2">.rg.bam"</span>
</span><span id="__span-0-114"><a href="#__codelineno-0-114" id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Aligning </span><span class="nv">$fn</span><span class="s2"> -&gt; </span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">"</span><span class="nv">$out_bam</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>
</span><span id="__span-0-115"><a href="#__codelineno-0-115" id="__codelineno-0-115" name="__codelineno-0-115"></a>
</span><span id="__span-0-116"><a href="#__codelineno-0-116" id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">  </span><span class="c1"># Align and drop secondary (0x100) &amp; supplementary (0x800) alignments before RG tagging</span>
</span><span id="__span-0-117"><a href="#__codelineno-0-117" id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">  </span><span class="c1">#$BWA mem -M -t "$THREADS" "$REFGZ" "$R1" "$R2" \</span>
</span><span id="__span-0-118"><a href="#__codelineno-0-118" id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">  </span><span class="c1">#  | $SAM view -b -F 0x900 - \</span>
</span><span id="__span-0-119"><a href="#__codelineno-0-119" id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">  </span><span class="c1"># ...</span>
</span><span id="__span-0-120"><a href="#__codelineno-0-120" id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a href="#__codelineno-0-121" id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">  </span><span class="c1"># Align without filtering (keep all alignments):</span>
</span><span id="__span-0-122"><a href="#__codelineno-0-122" id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="w">  </span><span class="nv">$BWA</span><span class="w"> </span>mem<span class="w"> </span>-M<span class="w"> </span>-t<span class="w"> </span><span class="s2">"</span><span class="nv">$THREADS</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$REFGZ</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$R1</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$R2</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-123"><a href="#__codelineno-0-123" id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>AddOrReplaceReadGroups<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-124"><a href="#__codelineno-0-124" id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">        </span>--INPUT<span class="w"> </span>/dev/stdin<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-125"><a href="#__codelineno-0-125" id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">        </span>--OUTPUT<span class="w"> </span><span class="s2">"</span><span class="nv">$out_bam</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-126"><a href="#__codelineno-0-126" id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">        </span>--TMP_DIR<span class="w"> </span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-127"><a href="#__codelineno-0-127" id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">        </span>--RGPL<span class="w"> </span>ILLUMINA<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-128"><a href="#__codelineno-0-128" id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="w">        </span>--RGLB<span class="w"> </span>sureselect<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-129"><a href="#__codelineno-0-129" id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">        </span>--RGSM<span class="w"> </span><span class="s2">"</span><span class="nv">$SAMPLE</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-130"><a href="#__codelineno-0-130" id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">        </span>--RGID<span class="w"> </span><span class="s2">"</span><span class="nv">$RGID</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-131"><a href="#__codelineno-0-131" id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">        </span>--RGPU<span class="w"> </span><span class="s2">"</span><span class="nv">$RGPU</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-132"><a href="#__codelineno-0-132" id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-133"><a href="#__codelineno-0-133" id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">done</span>
</span><span id="__span-0-134"><a href="#__codelineno-0-134" id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a href="#__codelineno-0-135" id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-136"><a href="#__codelineno-0-136" id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="c1"># STEP 2: Merge Lane-level BAMs</span>
</span><span id="__span-0-137"><a href="#__codelineno-0-137" id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="c1"># Theory: Merging ensures downstream duplicate marking and BQSR</span>
</span><span id="__span-0-138"><a href="#__codelineno-0-138" id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="c1"># operate on the full sample, minimizing lane-specific biases.</span>
</span><span id="__span-0-139"><a href="#__codelineno-0-139" id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-140"><a href="#__codelineno-0-140" id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 2: Merge lane-level BAMs"</span>
</span><span id="__span-0-141"><a href="#__codelineno-0-141" id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="nv">rg_bams</span><span class="o">=(</span><span class="w"> </span><span class="nv">$BAMDIR</span>/*.rg.bam<span class="w"> </span><span class="o">)</span>
</span><span id="__span-0-142"><a href="#__codelineno-0-142" id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-143"><a href="#__codelineno-0-143" id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>MergeSamFiles<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-144"><a href="#__codelineno-0-144" id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">  </span><span class="si">${</span><span class="nv">rg_bams</span><span class="p">[@]/#/-I </span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-145"><a href="#__codelineno-0-145" id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-146"><a href="#__codelineno-0-146" id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">  </span>--CREATE_INDEX<span class="w"> </span><span class="nb">true</span><span class="w"> </span>--VALIDATION_STRINGENCY<span class="w"> </span>SILENT<span class="w"> </span>--TMP_DIR<span class="w"> </span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-147"><a href="#__codelineno-0-147" id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="w">  </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-148"><a href="#__codelineno-0-148" id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="nb">set</span><span class="w"> </span>+x
</span><span id="__span-0-149"><a href="#__codelineno-0-149" id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a href="#__codelineno-0-150" id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-151"><a href="#__codelineno-0-151" id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="c1"># STEP 3: Mark Duplicates</span>
</span><span id="__span-0-152"><a href="#__codelineno-0-152" id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="c1"># Theory: PCR/optical duplicates inflate support for artefactual variants,</span>
</span><span id="__span-0-153"><a href="#__codelineno-0-153" id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="c1"># so marking them reduces false positives in variant calling.</span>
</span><span id="__span-0-154"><a href="#__codelineno-0-154" id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-155"><a href="#__codelineno-0-155" id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 3: Mark duplicates"</span>
</span><span id="__span-0-156"><a href="#__codelineno-0-156" id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-157"><a href="#__codelineno-0-157" id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>MarkDuplicates<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-158"><a href="#__codelineno-0-158" id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">  </span>-I<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-159"><a href="#__codelineno-0-159" id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-160"><a href="#__codelineno-0-160" id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="w">  </span>--METRICS_FILE<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.metrics.txt"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-161"><a href="#__codelineno-0-161" id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">  </span>--CREATE_INDEX<span class="w"> </span><span class="nb">true</span><span class="w"> </span>--TMP_DIR<span class="w"> </span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-162"><a href="#__codelineno-0-162" id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="w">  </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-163"><a href="#__codelineno-0-163" id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="nb">set</span><span class="w"> </span>+x
</span><span id="__span-0-164"><a href="#__codelineno-0-164" id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="nv">$SAM</span><span class="w"> </span>index<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.bam"</span>
</span><span id="__span-0-165"><a href="#__codelineno-0-165" id="__codelineno-0-165" name="__codelineno-0-165"></a>
</span><span id="__span-0-166"><a href="#__codelineno-0-166" id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-167"><a href="#__codelineno-0-167" id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="c1"># STEP 4: Base Quality Score Recalibration (BQSR)</span>
</span><span id="__span-0-168"><a href="#__codelineno-0-168" id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="c1"># Theory: Models systematic error in reported base qualities using known-sites,</span>
</span><span id="__span-0-169"><a href="#__codelineno-0-169" id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="c1"># improving the accuracy of variant calls by correcting quality scores.</span>
</span><span id="__span-0-170"><a href="#__codelineno-0-170" id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-171"><a href="#__codelineno-0-171" id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 4: Base recalibration"</span>
</span><span id="__span-0-172"><a href="#__codelineno-0-172" id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="nv">bqsr_table</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.recal.table"</span>
</span><span id="__span-0-173"><a href="#__codelineno-0-173" id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-174"><a href="#__codelineno-0-174" id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>BaseRecalibrator<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-175"><a href="#__codelineno-0-175" id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="w">  </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-176"><a href="#__codelineno-0-176" id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">  </span>-I<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-177"><a href="#__codelineno-0-177" id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="w">  </span>--known-sites<span class="w"> </span><span class="s2">"</span><span class="nv">$dbSNP</span><span class="s2">"</span><span class="w"> </span>--known-sites<span class="w"> </span><span class="s2">"</span><span class="nv">$MILLS_INDELS</span><span class="s2">"</span><span class="w"> </span>--known-sites<span class="w"> </span><span class="s2">"</span><span class="nv">$KG_INDELS</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-178"><a href="#__codelineno-0-178" id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$bqsr_table</span><span class="s2">"</span><span class="w"> </span>--tmp-dir<span class="w"> </span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-179"><a href="#__codelineno-0-179" id="__codelineno-0-179" name="__codelineno-0-179"></a>
</span><span id="__span-0-180"><a href="#__codelineno-0-180" id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>ApplyBQSR<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-181"><a href="#__codelineno-0-181" id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">  </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span>-I<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-182"><a href="#__codelineno-0-182" id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">  </span>--bqsr-recal-file<span class="w"> </span><span class="s2">"</span><span class="nv">$bqsr_table</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-183"><a href="#__codelineno-0-183" id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.recal.bam"</span><span class="w"> </span>--tmp-dir<span class="w"> </span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-184"><a href="#__codelineno-0-184" id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="nv">$SAM</span><span class="w"> </span>index<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.recal.bam"</span>
</span><span id="__span-0-185"><a href="#__codelineno-0-185" id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="nb">set</span><span class="w"> </span>+x
</span><span id="__span-0-186"><a href="#__codelineno-0-186" id="__codelineno-0-186" name="__codelineno-0-186"></a>
</span><span id="__span-0-187"><a href="#__codelineno-0-187" id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-188"><a href="#__codelineno-0-188" id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="c1"># STEP 5: HaplotypeCaller -&gt; gVCF</span>
</span><span id="__span-0-189"><a href="#__codelineno-0-189" id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="c1"># Theory: Local de Bruijn graph assembly per active region improves indel calling;</span>
</span><span id="__span-0-190"><a href="#__codelineno-0-190" id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="c1"># emits reference-confidence gVCF required for joint genotyping.</span>
</span><span id="__span-0-191"><a href="#__codelineno-0-191" id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-192"><a href="#__codelineno-0-192" id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 5: HaplotypeCaller -&gt; gVCF"</span>
</span><span id="__span-0-193"><a href="#__codelineno-0-193" id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-194"><a href="#__codelineno-0-194" id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>HaplotypeCaller<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-195"><a href="#__codelineno-0-195" id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">  </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span>-I<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.recal.bam"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-196"><a href="#__codelineno-0-196" id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.g.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-197"><a href="#__codelineno-0-197" id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">  </span><span class="nv">$INTERVAL_ARG</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-198"><a href="#__codelineno-0-198" id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">  </span>--native-pair-hmm-threads<span class="w"> </span><span class="s2">"</span><span class="nv">$THREADS</span><span class="s2">"</span><span class="w"> </span>-ERC<span class="w"> </span>GVCF<span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-199"><a href="#__codelineno-0-199" id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="nb">set</span><span class="w"> </span>+x
</span><span id="__span-0-200"><a href="#__codelineno-0-200" id="__codelineno-0-200" name="__codelineno-0-200"></a>
</span><span id="__span-0-201"><a href="#__codelineno-0-201" id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-202"><a href="#__codelineno-0-202" id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="c1"># STEP 6: GenotypeGVCFs -&gt; Raw VCF</span>
</span><span id="__span-0-203"><a href="#__codelineno-0-203" id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="c1"># Theory: Jointly genotype one or more gVCFs to produce high-confidence sample VCF.</span>
</span><span id="__span-0-204"><a href="#__codelineno-0-204" id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-205"><a href="#__codelineno-0-205" id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 6: GenotypeGVCFs -&gt; raw VCF"</span>
</span><span id="__span-0-206"><a href="#__codelineno-0-206" id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-0-207"><a href="#__codelineno-0-207" id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>GenotypeGVCFs<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-208"><a href="#__codelineno-0-208" id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">  </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.g.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-209"><a href="#__codelineno-0-209" id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span><span class="w"> </span>--stand-call-conf<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-210"><a href="#__codelineno-0-210" id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="nb">set</span><span class="w"> </span>+x
</span><span id="__span-0-211"><a href="#__codelineno-0-211" id="__codelineno-0-211" name="__codelineno-0-211"></a>
</span><span id="__span-0-212"><a href="#__codelineno-0-212" id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-213"><a href="#__codelineno-0-213" id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="c1"># STEP 7: Build VQSR Models</span>
</span><span id="__span-0-214"><a href="#__codelineno-0-214" id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="c1"># Theory: Use Gaussian mixture models on variant annotations</span>
</span><span id="__span-0-215"><a href="#__codelineno-0-215" id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="c1"># to distinguish true variants from artefacts; requires sufficient counts.</span>
</span><span id="__span-0-216"><a href="#__codelineno-0-216" id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-217"><a href="#__codelineno-0-217" id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 7: Optional VQSR if enough variants"</span>
</span><span id="__span-0-218"><a href="#__codelineno-0-218" id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="nv">nSNP</span><span class="o">=</span><span class="k">$(</span>zgrep<span class="w"> </span>-v<span class="w"> </span><span class="s1">'^#'</span><span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'length($5)==1'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span>
</span><span id="__span-0-219"><a href="#__codelineno-0-219" id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="nv">nINDEL</span><span class="o">=</span><span class="k">$(</span>zgrep<span class="w"> </span>-v<span class="w"> </span><span class="s1">'^#'</span><span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'length($5)!=1'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span>
</span><span id="__span-0-220"><a href="#__codelineno-0-220" id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="nv">minSNP</span><span class="o">=</span><span class="m">1000</span><span class="p">;</span><span class="w"> </span><span class="nv">minINDEL</span><span class="o">=</span><span class="m">8000</span><span class="p">;</span><span class="w"> </span><span class="nv">apply_snp</span><span class="o">=</span>false<span class="p">;</span><span class="w"> </span><span class="nv">apply_indel</span><span class="o">=</span><span class="nb">false</span>
</span><span id="__span-0-221"><a href="#__codelineno-0-221" id="__codelineno-0-221" name="__codelineno-0-221"></a>
</span><span id="__span-0-222"><a href="#__codelineno-0-222" id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>nSNP<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>minSNP<span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-223"><a href="#__codelineno-0-223" id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">  </span><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>VariantRecalibrator<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-224"><a href="#__codelineno-0-224" id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-225"><a href="#__codelineno-0-225" id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-226"><a href="#__codelineno-0-226" id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="nv">$SNP_RES</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-227"><a href="#__codelineno-0-227" id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">    </span>-an<span class="w"> </span>QD<span class="w"> </span>-an<span class="w"> </span>MQRankSum<span class="w"> </span>-an<span class="w"> </span>ReadPosRankSum<span class="w"> </span>-an<span class="w"> </span>FS<span class="w"> </span>-an<span class="w"> </span>MQ<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-228"><a href="#__codelineno-0-228" id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="w">    </span>--mode<span class="w"> </span>SNP<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-229"><a href="#__codelineno-0-229" id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">    </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.snp.recal.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-230"><a href="#__codelineno-0-230" id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">    </span>--tranches-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.snp.tranches.txt"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-231"><a href="#__codelineno-0-231" id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">    </span>--max-gaussians<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-232"><a href="#__codelineno-0-232" id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">  </span><span class="nv">apply_snp</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-0-233"><a href="#__codelineno-0-233" id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="k">fi</span>
</span><span id="__span-0-234"><a href="#__codelineno-0-234" id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a href="#__codelineno-0-235" id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>nINDEL<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>minINDEL<span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-236"><a href="#__codelineno-0-236" id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">  </span><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>VariantRecalibrator<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-237"><a href="#__codelineno-0-237" id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">    </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-238"><a href="#__codelineno-0-238" id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">    </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-239"><a href="#__codelineno-0-239" id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="w">    </span><span class="nv">$INDEL_RES</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-240"><a href="#__codelineno-0-240" id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="w">    </span>-an<span class="w"> </span>QD<span class="w"> </span>-an<span class="w"> </span>FS<span class="w"> </span>-an<span class="w"> </span>ReadPosRankSum<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-241"><a href="#__codelineno-0-241" id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">    </span>--mode<span class="w"> </span>INDEL<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-242"><a href="#__codelineno-0-242" id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="w">    </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.indel.recal.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-243"><a href="#__codelineno-0-243" id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="w">    </span>--tranches-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.indel.tranches.txt"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-244"><a href="#__codelineno-0-244" id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="w">    </span>--max-gaussians<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-245"><a href="#__codelineno-0-245" id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="w">  </span><span class="nv">apply_indel</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-0-246"><a href="#__codelineno-0-246" id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="k">fi</span>
</span><span id="__span-0-247"><a href="#__codelineno-0-247" id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a href="#__codelineno-0-248" id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-249"><a href="#__codelineno-0-249" id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="c1"># STEP 8: Apply VQSR Models or Fallback</span>
</span><span id="__span-0-250"><a href="#__codelineno-0-250" id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-251"><a href="#__codelineno-0-251" id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 8: Apply VQSR or fallback"</span>
</span><span id="__span-0-252"><a href="#__codelineno-0-252" id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="nv">tmp_vcf</span><span class="o">=</span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.raw.vcf.gz"</span>
</span><span id="__span-0-253"><a href="#__codelineno-0-253" id="__codelineno-0-253" name="__codelineno-0-253"></a>
</span><span id="__span-0-254"><a href="#__codelineno-0-254" id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$apply_snp</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-255"><a href="#__codelineno-0-255" id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="w">  </span><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>ApplyVQSR<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-256"><a href="#__codelineno-0-256" id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="w">    </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$tmp_vcf</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-257"><a href="#__codelineno-0-257" id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="w">    </span>--recal-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.snp.recal.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-258"><a href="#__codelineno-0-258" id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="w">    </span>--tranches-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.snp.tranches.txt"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-259"><a href="#__codelineno-0-259" id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">    </span>--mode<span class="w"> </span>SNP<span class="w"> </span>--truth-sensitivity-filter-level<span class="w"> </span><span class="m">99</span>.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-260"><a href="#__codelineno-0-260" id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="w">    </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.post_snp.vcf.gz"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-261"><a href="#__codelineno-0-261" id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="w">  </span><span class="nv">tmp_vcf</span><span class="o">=</span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.post_snp.vcf.gz"</span>
</span><span id="__span-0-262"><a href="#__codelineno-0-262" id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="k">fi</span>
</span><span id="__span-0-263"><a href="#__codelineno-0-263" id="__codelineno-0-263" name="__codelineno-0-263"></a>
</span><span id="__span-0-264"><a href="#__codelineno-0-264" id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$apply_indel</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-265"><a href="#__codelineno-0-265" id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="w">  </span><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>ApplyVQSR<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-266"><a href="#__codelineno-0-266" id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="w">    </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$tmp_vcf</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-267"><a href="#__codelineno-0-267" id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="w">    </span>--recal-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.indel.recal.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-268"><a href="#__codelineno-0-268" id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="w">    </span>--tranches-file<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.indel.tranches.txt"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-269"><a href="#__codelineno-0-269" id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="w">    </span>--mode<span class="w"> </span>INDEL<span class="w"> </span>--truth-sensitivity-filter-level<span class="w"> </span><span class="m">95</span>.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-270"><a href="#__codelineno-0-270" id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="w">    </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.vqsr.vcf.gz"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-271"><a href="#__codelineno-0-271" id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">  </span><span class="nv">tmp_vcf</span><span class="o">=</span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.vqsr.vcf.gz"</span>
</span><span id="__span-0-272"><a href="#__codelineno-0-272" id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="k">fi</span>
</span><span id="__span-0-273"><a href="#__codelineno-0-273" id="__codelineno-0-273" name="__codelineno-0-273"></a>
</span><span id="__span-0-274"><a href="#__codelineno-0-274" id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-275"><a href="#__codelineno-0-275" id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="c1"># STEP 9: Hard-Filter &amp; Write QC VCF</span>
</span><span id="__span-0-276"><a href="#__codelineno-0-276" id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="c1"># Theory: Apply recommended hard filters on annotations when VQSR isn't applied or as QC.</span>
</span><span id="__span-0-277"><a href="#__codelineno-0-277" id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="c1">#   SNPs: QD&lt;2.0, FS&gt;60.0, MQ&lt;40.0, MQRankSum&lt;-12.5, ReadPosRankSum&lt;-8.0</span>
</span><span id="__span-0-278"><a href="#__codelineno-0-278" id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="c1">#   INDELs: QD&lt;2.0, FS&gt;200.0, ReadPosRankSum&lt;-20.0</span>
</span><span id="__span-0-279"><a href="#__codelineno-0-279" id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-280"><a href="#__codelineno-0-280" id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 9: Hard-filter &amp; write QC.vcf"</span>
</span><span id="__span-0-281"><a href="#__codelineno-0-281" id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="s2">"</span><span class="nv">$GATK4_BIN</span><span class="s2">"</span><span class="w"> </span><span class="nv">$GATK4_JAVA_OPTS</span><span class="w"> </span>VariantFiltration<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-282"><a href="#__codelineno-0-282" id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="w">  </span>-R<span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-283"><a href="#__codelineno-0-283" id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="w">  </span>-V<span class="w"> </span><span class="s2">"</span><span class="nv">$tmp_vcf</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-284"><a href="#__codelineno-0-284" id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"LowQUAL"</span><span class="w"> </span>--filter-expression<span class="w"> </span><span class="s2">"QUAL &lt; 30.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-285"><a href="#__codelineno-0-285" id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"QD2"</span><span class="w">        </span>--filter-expression<span class="w"> </span><span class="s2">"QD &lt; 2.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-286"><a href="#__codelineno-0-286" id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"FS60"</span><span class="w">       </span>--filter-expression<span class="w"> </span><span class="s2">"FS &gt; 60.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-287"><a href="#__codelineno-0-287" id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"MQ40"</span><span class="w">       </span>--filter-expression<span class="w"> </span><span class="s2">"MQ &lt; 40.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-288"><a href="#__codelineno-0-288" id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"MQRS-12.5"</span><span class="w">  </span>--filter-expression<span class="w"> </span><span class="s2">"MQRankSum &lt; -12.5"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-289"><a href="#__codelineno-0-289" id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"RPRS-8"</span><span class="w">     </span>--filter-expression<span class="w"> </span><span class="s2">"ReadPosRankSum &lt; -8.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-290"><a href="#__codelineno-0-290" id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"QD2_indel"</span><span class="w">  </span>--filter-expression<span class="w"> </span><span class="s2">"QD &lt; 2.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-291"><a href="#__codelineno-0-291" id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"FS200"</span><span class="w">      </span>--filter-expression<span class="w"> </span><span class="s2">"FS &gt; 200.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-292"><a href="#__codelineno-0-292" id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="w">  </span>--filter-name<span class="w"> </span><span class="s2">"RPRS-20"</span><span class="w">    </span>--filter-expression<span class="w"> </span><span class="s2">"ReadPosRankSum &lt; -20.0"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-293"><a href="#__codelineno-0-293" id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="w">  </span>-O<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.QC.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-294"><a href="#__codelineno-0-294" id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">  </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-295"><a href="#__codelineno-0-295" id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a href="#__codelineno-0-296" id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-297"><a href="#__codelineno-0-297" id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="c1"># STEP 10: Coverage Stats &amp; Sex Determination</span>
</span><span id="__span-0-298"><a href="#__codelineno-0-298" id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-299"><a href="#__codelineno-0-299" id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 10: Coverage &amp; Sex Determination"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-300"><a href="#__codelineno-0-300" id="__codelineno-0-300" name="__codelineno-0-300"></a>
</span><span id="__span-0-301"><a href="#__codelineno-0-301" id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="c1"># choose chromosome 1 naming</span>
</span><span id="__span-0-302"><a href="#__codelineno-0-302" id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$REF</span><span class="s2">"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*b37*.fasta<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-303"><a href="#__codelineno-0-303" id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="w">  </span><span class="nv">chrN</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-0-304"><a href="#__codelineno-0-304" id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="k">else</span>
</span><span id="__span-0-305"><a href="#__codelineno-0-305" id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="w">  </span><span class="nv">chrN</span><span class="o">=</span>chr1
</span><span id="__span-0-306"><a href="#__codelineno-0-306" id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="k">fi</span>
</span><span id="__span-0-307"><a href="#__codelineno-0-307" id="__codelineno-0-307" name="__codelineno-0-307"></a>
</span><span id="__span-0-308"><a href="#__codelineno-0-308" id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="nv">bam_raw</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.bam"</span>
</span><span id="__span-0-309"><a href="#__codelineno-0-309" id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="nv">bam_recal</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.rg.merged.dedup.recal.bam"</span>
</span><span id="__span-0-310"><a href="#__codelineno-0-310" id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="nv">out_raw</span><span class="o">=</span><span class="s2">"</span><span class="nv">$STATSDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">chrN</span><span class="si">}</span><span class="s2">.raw.bam"</span>
</span><span id="__span-0-311"><a href="#__codelineno-0-311" id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="nv">out_dedup</span><span class="o">=</span><span class="s2">"</span><span class="nv">$STATSDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">chrN</span><span class="si">}</span><span class="s2">.dedup.bam"</span>
</span><span id="__span-0-312"><a href="#__codelineno-0-312" id="__codelineno-0-312" name="__codelineno-0-312"></a>
</span><span id="__span-0-313"><a href="#__codelineno-0-313" id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="c1"># extract chr1 (or ‚Äú1‚Äù) reads and redirect errors</span>
</span><span id="__span-0-314"><a href="#__codelineno-0-314" id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="nv">$SAM</span><span class="w"> </span>view<span class="w"> </span>-b<span class="w"> </span><span class="s2">"</span><span class="nv">$bam_raw</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$chrN</span><span class="s2">"</span><span class="w">  </span>&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$out_raw</span><span class="s2">"</span><span class="w">   </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-315"><a href="#__codelineno-0-315" id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="nv">$SAM</span><span class="w"> </span>view<span class="w"> </span>-b<span class="w"> </span><span class="s2">"</span><span class="nv">$bam_recal</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$chrN</span><span class="s2">"</span><span class="w">  </span>&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$out_dedup</span><span class="s2">"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-316"><a href="#__codelineno-0-316" id="__codelineno-0-316" name="__codelineno-0-316"></a>
</span><span id="__span-0-317"><a href="#__codelineno-0-317" id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="c1"># index them, also logging STDERR</span>
</span><span id="__span-0-318"><a href="#__codelineno-0-318" id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="nv">$SAM</span><span class="w"> </span>index<span class="w"> </span><span class="s2">"</span><span class="nv">$out_raw</span><span class="s2">"</span><span class="w">    </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-319"><a href="#__codelineno-0-319" id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="nv">$SAM</span><span class="w"> </span>index<span class="w"> </span><span class="s2">"</span><span class="nv">$out_dedup</span><span class="s2">"</span><span class="w">  </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-320"><a href="#__codelineno-0-320" id="__codelineno-0-320" name="__codelineno-0-320"></a>
</span><span id="__span-0-321"><a href="#__codelineno-0-321" id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="c1"># run coverage &amp; sex scripts: STDOUT -&gt; stats file, STDERR -&gt; main log</span>
</span><span id="__span-0-322"><a href="#__codelineno-0-322" id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="s2">"</span><span class="nv">$BINDIR</span><span class="s2">"</span>/coverage.sh<span class="w"> </span><span class="s2">"</span><span class="nv">$id</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$out_raw</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$out_dedup</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$PIPELINE</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-323"><a href="#__codelineno-0-323" id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="w">    </span>&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$STATSDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.coverage.txt"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-324"><a href="#__codelineno-0-324" id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="s2">"</span><span class="nv">$BINDIR</span><span class="s2">"</span>/vcf2sex.sh<span class="w"> </span><span class="s2">"</span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.QC.vcf.gz"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-325"><a href="#__codelineno-0-325" id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">    </span>&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$STATSDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.sex.txt"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-326"><a href="#__codelineno-0-326" id="__codelineno-0-326" name="__codelineno-0-326"></a>
</span><span id="__span-0-327"><a href="#__codelineno-0-327" id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="c1"># Delete $STATSDIR/*bam</span>
</span><span id="__span-0-328"><a href="#__codelineno-0-328" id="__codelineno-0-328" name="__codelineno-0-328"></a>rm<span class="w"> </span><span class="s2">"</span><span class="nv">$out_raw</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$out_dedup</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$out_raw</span><span class="s2">.bai"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$out_dedup</span><span class="s2">.bai"</span>
</span><span id="__span-0-329"><a href="#__codelineno-0-329" id="__codelineno-0-329" name="__codelineno-0-329"></a>
</span><span id="__span-0-330"><a href="#__codelineno-0-330" id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-331"><a href="#__codelineno-0-331" id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="c1"># STEP 11: Cleanup BAMs (optional)</span>
</span><span id="__span-0-332"><a href="#__codelineno-0-332" id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="c1">#------------------------------------------------------------------------------</span>
</span><span id="__span-0-333"><a href="#__codelineno-0-333" id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLEANUP_BAM</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-0-334"><a href="#__codelineno-0-334" id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"&gt;&gt;&gt; STEP 11: Cleanup BAMs"</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-335"><a href="#__codelineno-0-335" id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="w">  </span><span class="c1"># -f silences ‚Äúno such file‚Äù errors if the glob is empty</span>
</span><span id="__span-0-336"><a href="#__codelineno-0-336" id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="w">  </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">"</span><span class="nv">$BAMDIR</span><span class="s2">"</span>/*.<span class="o">{</span>bam,bai<span class="o">}</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LOG</span><span class="s2">"</span>
</span><span id="__span-0-337"><a href="#__codelineno-0-337" id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="k">fi</span>
</span><span id="__span-0-338"><a href="#__codelineno-0-338" id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a href="#__codelineno-0-339" id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="c1"># End</span>
</span><span id="__span-0-340"><a href="#__codelineno-0-340" id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"All done! QC VCF: </span><span class="nv">$VARCALLDIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">.hc.QC.vcf.gz"</span>
</span></code></pre></div>
</details>
</div>
<div class="tabbed-block">
<details class="example">
<summary>See Snakemake pipeline:</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># wes_single.smk - bash-replica of wes_single.sh (GATK4.6) with per-rule logs</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>import<span class="w"> </span>os
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>import<span class="w"> </span>glob
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>import<span class="w"> </span>platform
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>import<span class="w"> </span>shlex
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>from<span class="w"> </span>pathlib<span class="w"> </span>import<span class="w"> </span>Path
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="nv">snakefile_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Path<span class="o">(</span>workflow.snakefile<span class="o">)</span>.parent
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>configfile:<span class="w"> </span>str<span class="o">(</span>snakefile_dir<span class="w"> </span>/<span class="w"> </span><span class="s2">"config.yaml"</span><span class="o">)</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="c1"># Environment (match bash)</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>os.environ<span class="o">[</span><span class="s2">"TMPDIR"</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tmpdir"</span><span class="o">]</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>os.environ<span class="o">[</span><span class="s2">"LC_ALL"</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C"</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>os.environ<span class="o">[</span><span class="s2">"GATK_DISABLE_AUTO_S3_UPLOAD"</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="c1"># Config / tools</span>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="nv">DATADIR</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"datadir"</span><span class="o">]</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="nv">DBDIR</span><span class="w">    </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"dbdir"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">datadir</span><span class="o">=</span>DATADIR<span class="o">)</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="nv">NGSUTILS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"ngsutils"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">datadir</span><span class="o">=</span>DATADIR<span class="o">)</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="nv">TMPDIR</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tmpdir"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">datadir</span><span class="o">=</span>DATADIR<span class="o">)</span>
</span><span id="__span-1-25"><a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="nv">MEM</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>config.get<span class="o">(</span><span class="s2">"mem"</span>,<span class="w"> </span><span class="s2">"8G"</span><span class="o">)</span>
</span><span id="__span-1-26"><a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a>
</span><span id="__span-1-27"><a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="nv">PIPELINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config.get<span class="o">(</span><span class="s2">"pipeline"</span>,<span class="w"> </span><span class="s2">"wes"</span><span class="o">)</span>.lower<span class="o">()</span>
</span><span id="__span-1-28"><a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="k">if</span><span class="w"> </span>PIPELINE<span class="w"> </span>not<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span><span class="s2">"wes"</span>,<span class="w"> </span><span class="s2">"wgs"</span><span class="o">)</span>:
</span><span id="__span-1-29"><a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">    </span>raise<span class="w"> </span>ValueError<span class="o">(</span><span class="s2">"config[pipeline] must be 'wes' or 'wgs'"</span><span class="o">)</span>
</span><span id="__span-1-30"><a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a>
</span><span id="__span-1-31"><a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="nv">CLEANUP_BAM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bool<span class="o">(</span>config.get<span class="o">(</span><span class="s2">"cleanup_bam"</span>,<span class="w"> </span>False<span class="o">))</span>
</span><span id="__span-1-32"><a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a>
</span><span id="__span-1-33"><a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="nv">THREADS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>workflow.cores<span class="w"> </span>or<span class="w"> </span>int<span class="o">(</span>config.get<span class="o">(</span><span class="s2">"threads"</span>,<span class="w"> </span><span class="m">4</span><span class="o">))</span>
</span><span id="__span-1-34"><a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a>
</span><span id="__span-1-35"><a href="#__codelineno-1-35" id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="nv">ARCH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>platform.machine<span class="o">()</span>
</span><span id="__span-1-36"><a href="#__codelineno-1-36" id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="k">if</span><span class="w"> </span><span class="nv">ARCH</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"aarch64"</span>:
</span><span id="__span-1-37"><a href="#__codelineno-1-37" id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">    </span><span class="nv">JAVA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"java"</span><span class="o">][</span><span class="s2">"aarch64"</span><span class="o">]</span>
</span><span id="__span-1-38"><a href="#__codelineno-1-38" id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="nv">BWA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tools"</span><span class="o">][</span><span class="s2">"aarch64"</span><span class="o">][</span><span class="s2">"bwa"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">ngsutils</span><span class="o">=</span>NGSUTILS<span class="o">)</span>
</span><span id="__span-1-39"><a href="#__codelineno-1-39" id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">    </span><span class="nv">SAM</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tools"</span><span class="o">][</span><span class="s2">"aarch64"</span><span class="o">][</span><span class="s2">"samtools"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">ngsutils</span><span class="o">=</span>NGSUTILS<span class="o">)</span>
</span><span id="__span-1-40"><a href="#__codelineno-1-40" id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="k">else</span>:
</span><span id="__span-1-41"><a href="#__codelineno-1-41" id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">    </span><span class="nv">JAVA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"java"</span><span class="o">][</span><span class="s2">"amd64"</span><span class="o">]</span>
</span><span id="__span-1-42"><a href="#__codelineno-1-42" id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">    </span><span class="nv">BWA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tools"</span><span class="o">][</span><span class="s2">"amd64"</span><span class="o">][</span><span class="s2">"bwa"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">ngsutils</span><span class="o">=</span>NGSUTILS<span class="o">)</span>
</span><span id="__span-1-43"><a href="#__codelineno-1-43" id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="nv">SAM</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"tools"</span><span class="o">][</span><span class="s2">"amd64"</span><span class="o">][</span><span class="s2">"samtools"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">ngsutils</span><span class="o">=</span>NGSUTILS<span class="o">)</span>
</span><span id="__span-1-44"><a href="#__codelineno-1-44" id="__codelineno-1-44" name="__codelineno-1-44"></a>
</span><span id="__span-1-45"><a href="#__codelineno-1-45" id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="nv">GATK4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"gatk4_cmd"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">ngsutils</span><span class="o">=</span>NGSUTILS,<span class="w"> </span><span class="nv">mem</span><span class="o">=</span>MEM<span class="o">)</span>
</span><span id="__span-1-46"><a href="#__codelineno-1-46" id="__codelineno-1-46" name="__codelineno-1-46"></a>
</span><span id="__span-1-47"><a href="#__codelineno-1-47" id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="nv">COV</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>str<span class="o">(</span>snakefile_dir<span class="w"> </span>/<span class="w"> </span><span class="s2">"coverage.sh"</span><span class="o">)</span>
</span><span id="__span-1-48"><a href="#__codelineno-1-48" id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="nv">VCF2SEX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>str<span class="o">(</span>snakefile_dir<span class="w"> </span>/<span class="w"> </span><span class="s2">"vcf2sex.sh"</span><span class="o">)</span>
</span><span id="__span-1-49"><a href="#__codelineno-1-49" id="__codelineno-1-49" name="__codelineno-1-49"></a>
</span><span id="__span-1-50"><a href="#__codelineno-1-50" id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="nv">bundle</span><span class="w">       </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"bundle"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">dbdir</span><span class="o">=</span>DBDIR<span class="o">)</span>
</span><span id="__span-1-51"><a href="#__codelineno-1-51" id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="nv">REF</span><span class="w">          </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"ref"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-52"><a href="#__codelineno-1-52" id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="nv">REFGZ</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"refgz"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-53"><a href="#__codelineno-1-53" id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="nv">dbSNP</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"dbsnp"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">dbdir</span><span class="o">=</span>DBDIR<span class="o">)</span>
</span><span id="__span-1-54"><a href="#__codelineno-1-54" id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="nv">MILLS_INDELS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"mills_indels"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-55"><a href="#__codelineno-1-55" id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="nv">KG_INDELS</span><span class="w">    </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"kg_indels"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-56"><a href="#__codelineno-1-56" id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="nv">HAPMAP</span><span class="w">       </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"hapmap"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-57"><a href="#__codelineno-1-57" id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="nv">OMNI</span><span class="w">         </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"omni"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-58"><a href="#__codelineno-1-58" id="__codelineno-1-58" name="__codelineno-1-58"></a>
</span><span id="__span-1-59"><a href="#__codelineno-1-59" id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="nv">SNP_RES</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"snp_res"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">hapmap</span><span class="o">=</span>HAPMAP,<span class="w"> </span><span class="nv">omni</span><span class="o">=</span>OMNI,<span class="w"> </span><span class="nv">dbsnp</span><span class="o">=</span>dbSNP<span class="o">)</span>
</span><span id="__span-1-60"><a href="#__codelineno-1-60" id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="nv">INDEL_RES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"indel_res"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">mills_indels</span><span class="o">=</span>MILLS_INDELS<span class="o">)</span>
</span><span id="__span-1-61"><a href="#__codelineno-1-61" id="__codelineno-1-61" name="__codelineno-1-61"></a>
</span><span id="__span-1-62"><a href="#__codelineno-1-62" id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="nv">INTERVAL_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>config<span class="o">[</span><span class="s2">"interval_list"</span><span class="o">]</span>.format<span class="o">(</span><span class="nv">bundle</span><span class="o">=</span>bundle<span class="o">)</span>
</span><span id="__span-1-63"><a href="#__codelineno-1-63" id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="nv">INTERVAL_ARG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>f<span class="s2">"-L {shlex.quote(INTERVAL_LIST)}"</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">PIPELINE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"wes"</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-1-64"><a href="#__codelineno-1-64" id="__codelineno-1-64" name="__codelineno-1-64"></a>
</span><span id="__span-1-65"><a href="#__codelineno-1-65" id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="nv">MIN_SNP_FOR_VQSR</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>config.get<span class="o">(</span><span class="s2">"min_snp_for_vqsr"</span>,<span class="w"> </span><span class="m">1000</span><span class="o">))</span>
</span><span id="__span-1-66"><a href="#__codelineno-1-66" id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="nv">MIN_INDEL_FOR_VQSR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>config.get<span class="o">(</span><span class="s2">"min_indel_for_vqsr"</span>,<span class="w"> </span><span class="m">8000</span><span class="o">))</span>
</span><span id="__span-1-67"><a href="#__codelineno-1-67" id="__codelineno-1-67" name="__codelineno-1-67"></a>
</span><span id="__span-1-68"><a href="#__codelineno-1-68" id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="c1"># Output dirs</span>
</span><span id="__span-1-69"><a href="#__codelineno-1-69" id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="nv">BAMDIR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"01_bam"</span>
</span><span id="__span-1-70"><a href="#__codelineno-1-70" id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="nv">VARCALLDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"02_varcall"</span>
</span><span id="__span-1-71"><a href="#__codelineno-1-71" id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="nv">STATSDIR</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"03_stats"</span>
</span><span id="__span-1-72"><a href="#__codelineno-1-72" id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="nv">LOGDIR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"logs"</span>
</span><span id="__span-1-73"><a href="#__codelineno-1-73" id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="k">for</span><span class="w"> </span>d<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>BAMDIR,<span class="w"> </span>VARCALLDIR,<span class="w"> </span>STATSDIR,<span class="w"> </span>LOGDIR<span class="o">)</span>:
</span><span id="__span-1-74"><a href="#__codelineno-1-74" id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">    </span>os.makedirs<span class="o">(</span>d,<span class="w"> </span><span class="nv">exist_ok</span><span class="o">=</span>True<span class="o">)</span>
</span><span id="__span-1-75"><a href="#__codelineno-1-75" id="__codelineno-1-75" name="__codelineno-1-75"></a>
</span><span id="__span-1-76"><a href="#__codelineno-1-76" id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-77"><a href="#__codelineno-1-77" id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="c1"># Sample ID (match bash)</span>
</span><span id="__span-1-78"><a href="#__codelineno-1-78" id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-79"><a href="#__codelineno-1-79" id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="nv">rawid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Path.cwd<span class="o">()</span>.parent.name
</span><span id="__span-1-80"><a href="#__codelineno-1-80" id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="nv">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rawid.split<span class="o">(</span><span class="s2">"_"</span>,<span class="w"> </span><span class="m">1</span><span class="o">)[</span><span class="m">0</span><span class="o">]</span>
</span><span id="__span-1-81"><a href="#__codelineno-1-81" id="__codelineno-1-81" name="__codelineno-1-81"></a>
</span><span id="__span-1-82"><a href="#__codelineno-1-82" id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-83"><a href="#__codelineno-1-83" id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="c1"># FASTQ pairs (match bash glob)</span>
</span><span id="__span-1-84"><a href="#__codelineno-1-84" id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-85"><a href="#__codelineno-1-85" id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="nv">FASTQ_DIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"../"</span>
</span><span id="__span-1-86"><a href="#__codelineno-1-86" id="__codelineno-1-86" name="__codelineno-1-86"></a><span class="nv">FASTQ_R1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sorted<span class="o">(</span>glob.glob<span class="o">(</span>os.path.join<span class="o">(</span>FASTQ_DIR,<span class="w"> </span><span class="s2">"*_R1_*fastq.gz"</span><span class="o">)))</span>
</span><span id="__span-1-87"><a href="#__codelineno-1-87" id="__codelineno-1-87" name="__codelineno-1-87"></a><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>FASTQ_R1:
</span><span id="__span-1-88"><a href="#__codelineno-1-88" id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="w">    </span>raise<span class="w"> </span>ValueError<span class="o">(</span><span class="s2">"No FASTQs found matching ../*_R1_*fastq.gz"</span><span class="o">)</span>
</span><span id="__span-1-89"><a href="#__codelineno-1-89" id="__codelineno-1-89" name="__codelineno-1-89"></a>
</span><span id="__span-1-90"><a href="#__codelineno-1-90" id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="nv">FASTQ_BASES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
</span><span id="__span-1-91"><a href="#__codelineno-1-91" id="__codelineno-1-91" name="__codelineno-1-91"></a><span class="nv">FASTQ_DICT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span>
</span><span id="__span-1-92"><a href="#__codelineno-1-92" id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="k">for</span><span class="w"> </span>r1<span class="w"> </span><span class="k">in</span><span class="w"> </span>FASTQ_R1:
</span><span id="__span-1-93"><a href="#__codelineno-1-93" id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="w">    </span><span class="nv">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r1.replace<span class="o">(</span><span class="s2">"_R1_"</span>,<span class="w"> </span><span class="s2">"_R2_"</span><span class="o">)</span>
</span><span id="__span-1-94"><a href="#__codelineno-1-94" id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.path.basename<span class="o">(</span>r1<span class="o">)</span>.replace<span class="o">(</span><span class="s2">".fastq.gz"</span>,<span class="w"> </span><span class="s2">""</span><span class="o">)</span>
</span><span id="__span-1-95"><a href="#__codelineno-1-95" id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base.split<span class="o">(</span><span class="s2">"_R1_"</span>,<span class="w"> </span><span class="m">1</span><span class="o">)[</span><span class="m">0</span><span class="o">]</span>
</span><span id="__span-1-96"><a href="#__codelineno-1-96" id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="w">    </span>FASTQ_BASES.append<span class="o">(</span>base<span class="o">)</span>
</span><span id="__span-1-97"><a href="#__codelineno-1-97" id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="w">    </span>FASTQ_DICT<span class="o">[</span>base<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s2">"r1"</span>:<span class="w"> </span>r1,<span class="w"> </span><span class="s2">"r2"</span>:<span class="w"> </span>r2<span class="o">}</span>
</span><span id="__span-1-98"><a href="#__codelineno-1-98" id="__codelineno-1-98" name="__codelineno-1-98"></a>
</span><span id="__span-1-99"><a href="#__codelineno-1-99" id="__codelineno-1-99" name="__codelineno-1-99"></a><span class="nv">RG_BAMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{b}.rg.bam"</span><span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>b<span class="w"> </span><span class="k">in</span><span class="w"> </span>FASTQ_BASES<span class="o">]</span>
</span><span id="__span-1-100"><a href="#__codelineno-1-100" id="__codelineno-1-100" name="__codelineno-1-100"></a>
</span><span id="__span-1-101"><a href="#__codelineno-1-101" id="__codelineno-1-101" name="__codelineno-1-101"></a><span class="nv">CHR1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s2">"b37"</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>str<span class="o">(</span>REF<span class="o">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">"chr1"</span>
</span><span id="__span-1-102"><a href="#__codelineno-1-102" id="__codelineno-1-102" name="__codelineno-1-102"></a>
</span><span id="__span-1-103"><a href="#__codelineno-1-103" id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-104"><a href="#__codelineno-1-104" id="__codelineno-1-104" name="__codelineno-1-104"></a><span class="c1"># Targets</span>
</span><span id="__span-1-105"><a href="#__codelineno-1-105" id="__codelineno-1-105" name="__codelineno-1-105"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-106"><a href="#__codelineno-1-106" id="__codelineno-1-106" name="__codelineno-1-106"></a><span class="nv">FINAL_INPUTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
</span><span id="__span-1-107"><a href="#__codelineno-1-107" id="__codelineno-1-107" name="__codelineno-1-107"></a><span class="w">    </span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.QC.vcf.gz"</span><span class="o">)</span>,
</span><span id="__span-1-108"><a href="#__codelineno-1-108" id="__codelineno-1-108" name="__codelineno-1-108"></a><span class="w">    </span>os.path.join<span class="o">(</span>STATSDIR,<span class="w">   </span>f<span class="s2">"{ID}.coverage.txt"</span><span class="o">)</span>,
</span><span id="__span-1-109"><a href="#__codelineno-1-109" id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="w">    </span>os.path.join<span class="o">(</span>STATSDIR,<span class="w">   </span>f<span class="s2">"{ID}.sex.txt"</span><span class="o">)</span>,
</span><span id="__span-1-110"><a href="#__codelineno-1-110" id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="o">]</span>
</span><span id="__span-1-111"><a href="#__codelineno-1-111" id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="k">if</span><span class="w"> </span>CLEANUP_BAM:
</span><span id="__span-1-112"><a href="#__codelineno-1-112" id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="w">    </span>FINAL_INPUTS.append<span class="o">(</span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.cleanup.done"</span><span class="o">))</span>
</span><span id="__span-1-113"><a href="#__codelineno-1-113" id="__codelineno-1-113" name="__codelineno-1-113"></a>
</span><span id="__span-1-114"><a href="#__codelineno-1-114" id="__codelineno-1-114" name="__codelineno-1-114"></a>rule<span class="w"> </span>all:
</span><span id="__span-1-115"><a href="#__codelineno-1-115" id="__codelineno-1-115" name="__codelineno-1-115"></a><span class="w">    </span>input:
</span><span id="__span-1-116"><a href="#__codelineno-1-116" id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="w">        </span>FINAL_INPUTS
</span><span id="__span-1-117"><a href="#__codelineno-1-117" id="__codelineno-1-117" name="__codelineno-1-117"></a>
</span><span id="__span-1-118"><a href="#__codelineno-1-118" id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-119"><a href="#__codelineno-1-119" id="__codelineno-1-119" name="__codelineno-1-119"></a><span class="c1"># STEP 1: Align &amp; AddReadGroups</span>
</span><span id="__span-1-120"><a href="#__codelineno-1-120" id="__codelineno-1-120" name="__codelineno-1-120"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-121"><a href="#__codelineno-1-121" id="__codelineno-1-121" name="__codelineno-1-121"></a>rule<span class="w"> </span>align_rg:
</span><span id="__span-1-122"><a href="#__codelineno-1-122" id="__codelineno-1-122" name="__codelineno-1-122"></a><span class="w">    </span>input:
</span><span id="__span-1-123"><a href="#__codelineno-1-123" id="__codelineno-1-123" name="__codelineno-1-123"></a><span class="w">        </span><span class="nv">r1</span><span class="o">=</span>lambda<span class="w"> </span>wc:<span class="w"> </span>FASTQ_DICT<span class="o">[</span>wc.base<span class="o">][</span><span class="s2">"r1"</span><span class="o">]</span>,
</span><span id="__span-1-124"><a href="#__codelineno-1-124" id="__codelineno-1-124" name="__codelineno-1-124"></a><span class="w">        </span><span class="nv">r2</span><span class="o">=</span>lambda<span class="w"> </span>wc:<span class="w"> </span>FASTQ_DICT<span class="o">[</span>wc.base<span class="o">][</span><span class="s2">"r2"</span><span class="o">]</span>,
</span><span id="__span-1-125"><a href="#__codelineno-1-125" id="__codelineno-1-125" name="__codelineno-1-125"></a><span class="w">    </span>output:
</span><span id="__span-1-126"><a href="#__codelineno-1-126" id="__codelineno-1-126" name="__codelineno-1-126"></a><span class="w">        </span><span class="nv">bam</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span><span class="s2">"{base}.rg.bam"</span><span class="o">)</span>,
</span><span id="__span-1-127"><a href="#__codelineno-1-127" id="__codelineno-1-127" name="__codelineno-1-127"></a><span class="w">    </span>threads:<span class="w"> </span>THREADS
</span><span id="__span-1-128"><a href="#__codelineno-1-128" id="__codelineno-1-128" name="__codelineno-1-128"></a><span class="w">    </span>log:
</span><span id="__span-1-129"><a href="#__codelineno-1-129" id="__codelineno-1-129" name="__codelineno-1-129"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.01_align_rg.{{base}}.log"</span><span class="o">)</span>
</span><span id="__span-1-130"><a href="#__codelineno-1-130" id="__codelineno-1-130" name="__codelineno-1-130"></a><span class="w">    </span>shell:
</span><span id="__span-1-131"><a href="#__codelineno-1-131" id="__codelineno-1-131" name="__codelineno-1-131"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-132"><a href="#__codelineno-1-132" id="__codelineno-1-132" name="__codelineno-1-132"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-133"><a href="#__codelineno-1-133" id="__codelineno-1-133" name="__codelineno-1-133"></a><span class="s2">        SAMPLE=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="o">{</span>wildcards.base<span class="o">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">'_'</span><span class="w"> </span>-f1-2<span class="k">)</span>
</span><span id="__span-1-134"><a href="#__codelineno-1-134" id="__codelineno-1-134" name="__codelineno-1-134"></a><span class="s2">        LANE=</span><span class="k">$(</span><span class="nb">echo</span><span class="w">   </span><span class="o">{</span>wildcards.base<span class="o">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">'_'</span><span class="w"> </span>-f3<span class="k">)</span>
</span><span id="__span-1-135"><a href="#__codelineno-1-135" id="__codelineno-1-135" name="__codelineno-1-135"></a><span class="s2">        RGID="</span><span class="si">${</span><span class="p">{SAMPLE</span><span class="si">}</span><span class="o">}</span>.<span class="si">${</span><span class="p">{LANE</span><span class="si">}</span><span class="o">}</span>.<span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-1-136"><a href="#__codelineno-1-136" id="__codelineno-1-136" name="__codelineno-1-136"></a><span class="s2">        RGPU="</span><span class="si">${</span><span class="p">{SAMPLE</span><span class="si">}</span><span class="o">}</span>.<span class="si">${</span><span class="p">{LANE</span><span class="si">}</span><span class="o">}</span>.unit1<span class="s2">"</span>
</span><span id="__span-1-137"><a href="#__codelineno-1-137" id="__codelineno-1-137" name="__codelineno-1-137"></a>
</span><span id="__span-1-138"><a href="#__codelineno-1-138" id="__codelineno-1-138" name="__codelineno-1-138"></a><span class="s2">        {BWA} mem -M -t {threads} {REFGZ} {input.r1} {input.r2} \</span>
</span><span id="__span-1-139"><a href="#__codelineno-1-139" id="__codelineno-1-139" name="__codelineno-1-139"></a><span class="s2">          | {GATK4} AddOrReplaceReadGroups \</span>
</span><span id="__span-1-140"><a href="#__codelineno-1-140" id="__codelineno-1-140" name="__codelineno-1-140"></a><span class="s2">              --INPUT /dev/stdin \</span>
</span><span id="__span-1-141"><a href="#__codelineno-1-141" id="__codelineno-1-141" name="__codelineno-1-141"></a><span class="s2">              --OUTPUT {output.bam} \</span>
</span><span id="__span-1-142"><a href="#__codelineno-1-142" id="__codelineno-1-142" name="__codelineno-1-142"></a><span class="s2">              --TMP_DIR {TMPDIR} \</span>
</span><span id="__span-1-143"><a href="#__codelineno-1-143" id="__codelineno-1-143" name="__codelineno-1-143"></a><span class="s2">              --RGPL ILLUMINA \</span>
</span><span id="__span-1-144"><a href="#__codelineno-1-144" id="__codelineno-1-144" name="__codelineno-1-144"></a><span class="s2">              --RGLB sureselect \</span>
</span><span id="__span-1-145"><a href="#__codelineno-1-145" id="__codelineno-1-145" name="__codelineno-1-145"></a><span class="s2">              --RGSM "</span><span class="nv">$SAMPLE</span><span class="s2">" \</span>
</span><span id="__span-1-146"><a href="#__codelineno-1-146" id="__codelineno-1-146" name="__codelineno-1-146"></a><span class="s2">              --RGID "</span><span class="nv">$RGID</span><span class="s2">" \</span>
</span><span id="__span-1-147"><a href="#__codelineno-1-147" id="__codelineno-1-147" name="__codelineno-1-147"></a><span class="s2">              --RGPU "</span><span class="nv">$RGPU</span><span class="s2">" \</span>
</span><span id="__span-1-148"><a href="#__codelineno-1-148" id="__codelineno-1-148" name="__codelineno-1-148"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-149"><a href="#__codelineno-1-149" id="__codelineno-1-149" name="__codelineno-1-149"></a><span class="s2">        """</span>
</span><span id="__span-1-150"><a href="#__codelineno-1-150" id="__codelineno-1-150" name="__codelineno-1-150"></a>
</span><span id="__span-1-151"><a href="#__codelineno-1-151" id="__codelineno-1-151" name="__codelineno-1-151"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-152"><a href="#__codelineno-1-152" id="__codelineno-1-152" name="__codelineno-1-152"></a><span class="c1"># STEP 2: Merge lane BAMs</span>
</span><span id="__span-1-153"><a href="#__codelineno-1-153" id="__codelineno-1-153" name="__codelineno-1-153"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-154"><a href="#__codelineno-1-154" id="__codelineno-1-154" name="__codelineno-1-154"></a>rule<span class="w"> </span>merge_bams:
</span><span id="__span-1-155"><a href="#__codelineno-1-155" id="__codelineno-1-155" name="__codelineno-1-155"></a><span class="w">    </span>input:
</span><span id="__span-1-156"><a href="#__codelineno-1-156" id="__codelineno-1-156" name="__codelineno-1-156"></a><span class="w">        </span><span class="nv">rg_bams</span><span class="o">=</span>RG_BAMS
</span><span id="__span-1-157"><a href="#__codelineno-1-157" id="__codelineno-1-157" name="__codelineno-1-157"></a><span class="w">    </span>output:
</span><span id="__span-1-158"><a href="#__codelineno-1-158" id="__codelineno-1-158" name="__codelineno-1-158"></a><span class="w">        </span><span class="nv">merged</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.bam"</span><span class="o">)</span>
</span><span id="__span-1-159"><a href="#__codelineno-1-159" id="__codelineno-1-159" name="__codelineno-1-159"></a><span class="w">    </span>params:
</span><span id="__span-1-160"><a href="#__codelineno-1-160" id="__codelineno-1-160" name="__codelineno-1-160"></a><span class="w">        </span><span class="nv">merge_inputs</span><span class="o">=</span>lambda<span class="w"> </span>wc,<span class="w"> </span>input:<span class="w"> </span><span class="s2">" "</span>.join<span class="o">([</span>f<span class="s2">"-I {b}"</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>b<span class="w"> </span><span class="k">in</span><span class="w"> </span>input.rg_bams<span class="o">])</span>
</span><span id="__span-1-161"><a href="#__codelineno-1-161" id="__codelineno-1-161" name="__codelineno-1-161"></a><span class="w">    </span>log:
</span><span id="__span-1-162"><a href="#__codelineno-1-162" id="__codelineno-1-162" name="__codelineno-1-162"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.02_merge_bams.log"</span><span class="o">)</span>
</span><span id="__span-1-163"><a href="#__codelineno-1-163" id="__codelineno-1-163" name="__codelineno-1-163"></a><span class="w">    </span>shell:
</span><span id="__span-1-164"><a href="#__codelineno-1-164" id="__codelineno-1-164" name="__codelineno-1-164"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-165"><a href="#__codelineno-1-165" id="__codelineno-1-165" name="__codelineno-1-165"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-166"><a href="#__codelineno-1-166" id="__codelineno-1-166" name="__codelineno-1-166"></a><span class="s2">        {GATK4} MergeSamFiles \</span>
</span><span id="__span-1-167"><a href="#__codelineno-1-167" id="__codelineno-1-167" name="__codelineno-1-167"></a><span class="s2">          {params.merge_inputs} \</span>
</span><span id="__span-1-168"><a href="#__codelineno-1-168" id="__codelineno-1-168" name="__codelineno-1-168"></a><span class="s2">          -O {output.merged} \</span>
</span><span id="__span-1-169"><a href="#__codelineno-1-169" id="__codelineno-1-169" name="__codelineno-1-169"></a><span class="s2">          --CREATE_INDEX true \</span>
</span><span id="__span-1-170"><a href="#__codelineno-1-170" id="__codelineno-1-170" name="__codelineno-1-170"></a><span class="s2">          --VALIDATION_STRINGENCY SILENT \</span>
</span><span id="__span-1-171"><a href="#__codelineno-1-171" id="__codelineno-1-171" name="__codelineno-1-171"></a><span class="s2">          --TMP_DIR {TMPDIR} \</span>
</span><span id="__span-1-172"><a href="#__codelineno-1-172" id="__codelineno-1-172" name="__codelineno-1-172"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-173"><a href="#__codelineno-1-173" id="__codelineno-1-173" name="__codelineno-1-173"></a><span class="s2">        """</span>
</span><span id="__span-1-174"><a href="#__codelineno-1-174" id="__codelineno-1-174" name="__codelineno-1-174"></a>
</span><span id="__span-1-175"><a href="#__codelineno-1-175" id="__codelineno-1-175" name="__codelineno-1-175"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-176"><a href="#__codelineno-1-176" id="__codelineno-1-176" name="__codelineno-1-176"></a><span class="c1"># STEP 3: MarkDuplicates (+ samtools index)</span>
</span><span id="__span-1-177"><a href="#__codelineno-1-177" id="__codelineno-1-177" name="__codelineno-1-177"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-178"><a href="#__codelineno-1-178" id="__codelineno-1-178" name="__codelineno-1-178"></a>rule<span class="w"> </span>mark_duplicates:
</span><span id="__span-1-179"><a href="#__codelineno-1-179" id="__codelineno-1-179" name="__codelineno-1-179"></a><span class="w">    </span>input:
</span><span id="__span-1-180"><a href="#__codelineno-1-180" id="__codelineno-1-180" name="__codelineno-1-180"></a><span class="w">        </span><span class="nv">merged</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.bam"</span><span class="o">)</span>
</span><span id="__span-1-181"><a href="#__codelineno-1-181" id="__codelineno-1-181" name="__codelineno-1-181"></a><span class="w">    </span>output:
</span><span id="__span-1-182"><a href="#__codelineno-1-182" id="__codelineno-1-182" name="__codelineno-1-182"></a><span class="w">        </span><span class="nv">dedup</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.bam"</span><span class="o">)</span>,
</span><span id="__span-1-183"><a href="#__codelineno-1-183" id="__codelineno-1-183" name="__codelineno-1-183"></a><span class="w">        </span><span class="nv">metrics</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.metrics.txt"</span><span class="o">)</span>
</span><span id="__span-1-184"><a href="#__codelineno-1-184" id="__codelineno-1-184" name="__codelineno-1-184"></a><span class="w">    </span>log:
</span><span id="__span-1-185"><a href="#__codelineno-1-185" id="__codelineno-1-185" name="__codelineno-1-185"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.03_mark_duplicates.log"</span><span class="o">)</span>
</span><span id="__span-1-186"><a href="#__codelineno-1-186" id="__codelineno-1-186" name="__codelineno-1-186"></a><span class="w">    </span>shell:
</span><span id="__span-1-187"><a href="#__codelineno-1-187" id="__codelineno-1-187" name="__codelineno-1-187"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-188"><a href="#__codelineno-1-188" id="__codelineno-1-188" name="__codelineno-1-188"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-189"><a href="#__codelineno-1-189" id="__codelineno-1-189" name="__codelineno-1-189"></a><span class="s2">        {GATK4} MarkDuplicates \</span>
</span><span id="__span-1-190"><a href="#__codelineno-1-190" id="__codelineno-1-190" name="__codelineno-1-190"></a><span class="s2">          -I {input.merged} \</span>
</span><span id="__span-1-191"><a href="#__codelineno-1-191" id="__codelineno-1-191" name="__codelineno-1-191"></a><span class="s2">          -O {output.dedup} \</span>
</span><span id="__span-1-192"><a href="#__codelineno-1-192" id="__codelineno-1-192" name="__codelineno-1-192"></a><span class="s2">          --METRICS_FILE {output.metrics} \</span>
</span><span id="__span-1-193"><a href="#__codelineno-1-193" id="__codelineno-1-193" name="__codelineno-1-193"></a><span class="s2">          --CREATE_INDEX true \</span>
</span><span id="__span-1-194"><a href="#__codelineno-1-194" id="__codelineno-1-194" name="__codelineno-1-194"></a><span class="s2">          --TMP_DIR {TMPDIR} \</span>
</span><span id="__span-1-195"><a href="#__codelineno-1-195" id="__codelineno-1-195" name="__codelineno-1-195"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-196"><a href="#__codelineno-1-196" id="__codelineno-1-196" name="__codelineno-1-196"></a><span class="s2">        {SAM} index {output.dedup} 2&gt;&gt; {log}</span>
</span><span id="__span-1-197"><a href="#__codelineno-1-197" id="__codelineno-1-197" name="__codelineno-1-197"></a><span class="s2">        """</span>
</span><span id="__span-1-198"><a href="#__codelineno-1-198" id="__codelineno-1-198" name="__codelineno-1-198"></a>
</span><span id="__span-1-199"><a href="#__codelineno-1-199" id="__codelineno-1-199" name="__codelineno-1-199"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-200"><a href="#__codelineno-1-200" id="__codelineno-1-200" name="__codelineno-1-200"></a><span class="c1"># STEP 4: BQSR</span>
</span><span id="__span-1-201"><a href="#__codelineno-1-201" id="__codelineno-1-201" name="__codelineno-1-201"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-202"><a href="#__codelineno-1-202" id="__codelineno-1-202" name="__codelineno-1-202"></a>rule<span class="w"> </span>bqsr:
</span><span id="__span-1-203"><a href="#__codelineno-1-203" id="__codelineno-1-203" name="__codelineno-1-203"></a><span class="w">    </span>input:
</span><span id="__span-1-204"><a href="#__codelineno-1-204" id="__codelineno-1-204" name="__codelineno-1-204"></a><span class="w">        </span><span class="nv">dedup</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.bam"</span><span class="o">)</span>
</span><span id="__span-1-205"><a href="#__codelineno-1-205" id="__codelineno-1-205" name="__codelineno-1-205"></a><span class="w">    </span>output:
</span><span id="__span-1-206"><a href="#__codelineno-1-206" id="__codelineno-1-206" name="__codelineno-1-206"></a><span class="w">        </span><span class="nv">table</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.recal.table"</span><span class="o">)</span>,
</span><span id="__span-1-207"><a href="#__codelineno-1-207" id="__codelineno-1-207" name="__codelineno-1-207"></a><span class="w">        </span><span class="nv">recal</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.recal.bam"</span><span class="o">)</span>
</span><span id="__span-1-208"><a href="#__codelineno-1-208" id="__codelineno-1-208" name="__codelineno-1-208"></a><span class="w">    </span>log:
</span><span id="__span-1-209"><a href="#__codelineno-1-209" id="__codelineno-1-209" name="__codelineno-1-209"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.04_bqsr.log"</span><span class="o">)</span>
</span><span id="__span-1-210"><a href="#__codelineno-1-210" id="__codelineno-1-210" name="__codelineno-1-210"></a><span class="w">    </span>shell:
</span><span id="__span-1-211"><a href="#__codelineno-1-211" id="__codelineno-1-211" name="__codelineno-1-211"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-212"><a href="#__codelineno-1-212" id="__codelineno-1-212" name="__codelineno-1-212"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-213"><a href="#__codelineno-1-213" id="__codelineno-1-213" name="__codelineno-1-213"></a><span class="s2">        {GATK4} BaseRecalibrator \</span>
</span><span id="__span-1-214"><a href="#__codelineno-1-214" id="__codelineno-1-214" name="__codelineno-1-214"></a><span class="s2">          -R {REF} \</span>
</span><span id="__span-1-215"><a href="#__codelineno-1-215" id="__codelineno-1-215" name="__codelineno-1-215"></a><span class="s2">          -I {input.dedup} \</span>
</span><span id="__span-1-216"><a href="#__codelineno-1-216" id="__codelineno-1-216" name="__codelineno-1-216"></a><span class="s2">          --known-sites {dbSNP} \</span>
</span><span id="__span-1-217"><a href="#__codelineno-1-217" id="__codelineno-1-217" name="__codelineno-1-217"></a><span class="s2">          --known-sites {MILLS_INDELS} \</span>
</span><span id="__span-1-218"><a href="#__codelineno-1-218" id="__codelineno-1-218" name="__codelineno-1-218"></a><span class="s2">          --known-sites {KG_INDELS} \</span>
</span><span id="__span-1-219"><a href="#__codelineno-1-219" id="__codelineno-1-219" name="__codelineno-1-219"></a><span class="s2">          -O {output.table} \</span>
</span><span id="__span-1-220"><a href="#__codelineno-1-220" id="__codelineno-1-220" name="__codelineno-1-220"></a><span class="s2">          --tmp-dir {TMPDIR} \</span>
</span><span id="__span-1-221"><a href="#__codelineno-1-221" id="__codelineno-1-221" name="__codelineno-1-221"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-222"><a href="#__codelineno-1-222" id="__codelineno-1-222" name="__codelineno-1-222"></a>
</span><span id="__span-1-223"><a href="#__codelineno-1-223" id="__codelineno-1-223" name="__codelineno-1-223"></a><span class="s2">        {GATK4} ApplyBQSR \</span>
</span><span id="__span-1-224"><a href="#__codelineno-1-224" id="__codelineno-1-224" name="__codelineno-1-224"></a><span class="s2">          -R {REF} \</span>
</span><span id="__span-1-225"><a href="#__codelineno-1-225" id="__codelineno-1-225" name="__codelineno-1-225"></a><span class="s2">          -I {input.dedup} \</span>
</span><span id="__span-1-226"><a href="#__codelineno-1-226" id="__codelineno-1-226" name="__codelineno-1-226"></a><span class="s2">          --bqsr-recal-file {output.table} \</span>
</span><span id="__span-1-227"><a href="#__codelineno-1-227" id="__codelineno-1-227" name="__codelineno-1-227"></a><span class="s2">          -O {output.recal} \</span>
</span><span id="__span-1-228"><a href="#__codelineno-1-228" id="__codelineno-1-228" name="__codelineno-1-228"></a><span class="s2">          --tmp-dir {TMPDIR} \</span>
</span><span id="__span-1-229"><a href="#__codelineno-1-229" id="__codelineno-1-229" name="__codelineno-1-229"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-230"><a href="#__codelineno-1-230" id="__codelineno-1-230" name="__codelineno-1-230"></a>
</span><span id="__span-1-231"><a href="#__codelineno-1-231" id="__codelineno-1-231" name="__codelineno-1-231"></a><span class="s2">        {SAM} index {output.recal} 2&gt;&gt; {log}</span>
</span><span id="__span-1-232"><a href="#__codelineno-1-232" id="__codelineno-1-232" name="__codelineno-1-232"></a><span class="s2">        """</span>
</span><span id="__span-1-233"><a href="#__codelineno-1-233" id="__codelineno-1-233" name="__codelineno-1-233"></a>
</span><span id="__span-1-234"><a href="#__codelineno-1-234" id="__codelineno-1-234" name="__codelineno-1-234"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-235"><a href="#__codelineno-1-235" id="__codelineno-1-235" name="__codelineno-1-235"></a><span class="c1"># STEP 5: HaplotypeCaller -&gt; gVCF</span>
</span><span id="__span-1-236"><a href="#__codelineno-1-236" id="__codelineno-1-236" name="__codelineno-1-236"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-237"><a href="#__codelineno-1-237" id="__codelineno-1-237" name="__codelineno-1-237"></a>rule<span class="w"> </span>haplotypecaller:
</span><span id="__span-1-238"><a href="#__codelineno-1-238" id="__codelineno-1-238" name="__codelineno-1-238"></a><span class="w">    </span>input:
</span><span id="__span-1-239"><a href="#__codelineno-1-239" id="__codelineno-1-239" name="__codelineno-1-239"></a><span class="w">        </span><span class="nv">recal</span><span class="o">=</span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.recal.bam"</span><span class="o">)</span>
</span><span id="__span-1-240"><a href="#__codelineno-1-240" id="__codelineno-1-240" name="__codelineno-1-240"></a><span class="w">    </span>output:
</span><span id="__span-1-241"><a href="#__codelineno-1-241" id="__codelineno-1-241" name="__codelineno-1-241"></a><span class="w">        </span><span class="nv">gvcf</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.g.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-242"><a href="#__codelineno-1-242" id="__codelineno-1-242" name="__codelineno-1-242"></a><span class="w">    </span>threads:<span class="w"> </span>THREADS
</span><span id="__span-1-243"><a href="#__codelineno-1-243" id="__codelineno-1-243" name="__codelineno-1-243"></a><span class="w">    </span>log:
</span><span id="__span-1-244"><a href="#__codelineno-1-244" id="__codelineno-1-244" name="__codelineno-1-244"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.05_haplotypecaller.log"</span><span class="o">)</span>
</span><span id="__span-1-245"><a href="#__codelineno-1-245" id="__codelineno-1-245" name="__codelineno-1-245"></a><span class="w">    </span>shell:
</span><span id="__span-1-246"><a href="#__codelineno-1-246" id="__codelineno-1-246" name="__codelineno-1-246"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-247"><a href="#__codelineno-1-247" id="__codelineno-1-247" name="__codelineno-1-247"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-248"><a href="#__codelineno-1-248" id="__codelineno-1-248" name="__codelineno-1-248"></a><span class="s2">        {GATK4} HaplotypeCaller \</span>
</span><span id="__span-1-249"><a href="#__codelineno-1-249" id="__codelineno-1-249" name="__codelineno-1-249"></a><span class="s2">          -R {REF} \</span>
</span><span id="__span-1-250"><a href="#__codelineno-1-250" id="__codelineno-1-250" name="__codelineno-1-250"></a><span class="s2">          -I {input.recal} \</span>
</span><span id="__span-1-251"><a href="#__codelineno-1-251" id="__codelineno-1-251" name="__codelineno-1-251"></a><span class="s2">          -O {output.gvcf} \</span>
</span><span id="__span-1-252"><a href="#__codelineno-1-252" id="__codelineno-1-252" name="__codelineno-1-252"></a><span class="s2">          {INTERVAL_ARG} \</span>
</span><span id="__span-1-253"><a href="#__codelineno-1-253" id="__codelineno-1-253" name="__codelineno-1-253"></a><span class="s2">          --native-pair-hmm-threads {threads} \</span>
</span><span id="__span-1-254"><a href="#__codelineno-1-254" id="__codelineno-1-254" name="__codelineno-1-254"></a><span class="s2">          -ERC GVCF \</span>
</span><span id="__span-1-255"><a href="#__codelineno-1-255" id="__codelineno-1-255" name="__codelineno-1-255"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-256"><a href="#__codelineno-1-256" id="__codelineno-1-256" name="__codelineno-1-256"></a><span class="s2">        """</span>
</span><span id="__span-1-257"><a href="#__codelineno-1-257" id="__codelineno-1-257" name="__codelineno-1-257"></a>
</span><span id="__span-1-258"><a href="#__codelineno-1-258" id="__codelineno-1-258" name="__codelineno-1-258"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-259"><a href="#__codelineno-1-259" id="__codelineno-1-259" name="__codelineno-1-259"></a><span class="c1"># STEP 6: GenotypeGVCFs -&gt; raw VCF</span>
</span><span id="__span-1-260"><a href="#__codelineno-1-260" id="__codelineno-1-260" name="__codelineno-1-260"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-261"><a href="#__codelineno-1-261" id="__codelineno-1-261" name="__codelineno-1-261"></a>rule<span class="w"> </span>genotype_gvcfs:
</span><span id="__span-1-262"><a href="#__codelineno-1-262" id="__codelineno-1-262" name="__codelineno-1-262"></a><span class="w">    </span>input:
</span><span id="__span-1-263"><a href="#__codelineno-1-263" id="__codelineno-1-263" name="__codelineno-1-263"></a><span class="w">        </span><span class="nv">gvcf</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.g.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-264"><a href="#__codelineno-1-264" id="__codelineno-1-264" name="__codelineno-1-264"></a><span class="w">    </span>output:
</span><span id="__span-1-265"><a href="#__codelineno-1-265" id="__codelineno-1-265" name="__codelineno-1-265"></a><span class="w">        </span><span class="nv">raw</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.raw.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-266"><a href="#__codelineno-1-266" id="__codelineno-1-266" name="__codelineno-1-266"></a><span class="w">    </span>log:
</span><span id="__span-1-267"><a href="#__codelineno-1-267" id="__codelineno-1-267" name="__codelineno-1-267"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.06_genotype_gvcfs.log"</span><span class="o">)</span>
</span><span id="__span-1-268"><a href="#__codelineno-1-268" id="__codelineno-1-268" name="__codelineno-1-268"></a><span class="w">    </span>shell:
</span><span id="__span-1-269"><a href="#__codelineno-1-269" id="__codelineno-1-269" name="__codelineno-1-269"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-270"><a href="#__codelineno-1-270" id="__codelineno-1-270" name="__codelineno-1-270"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-271"><a href="#__codelineno-1-271" id="__codelineno-1-271" name="__codelineno-1-271"></a><span class="s2">        {GATK4} GenotypeGVCFs \</span>
</span><span id="__span-1-272"><a href="#__codelineno-1-272" id="__codelineno-1-272" name="__codelineno-1-272"></a><span class="s2">          -R {REF} \</span>
</span><span id="__span-1-273"><a href="#__codelineno-1-273" id="__codelineno-1-273" name="__codelineno-1-273"></a><span class="s2">          -V {input.gvcf} \</span>
</span><span id="__span-1-274"><a href="#__codelineno-1-274" id="__codelineno-1-274" name="__codelineno-1-274"></a><span class="s2">          -O {output.raw} \</span>
</span><span id="__span-1-275"><a href="#__codelineno-1-275" id="__codelineno-1-275" name="__codelineno-1-275"></a><span class="s2">          --stand-call-conf 10 \</span>
</span><span id="__span-1-276"><a href="#__codelineno-1-276" id="__codelineno-1-276" name="__codelineno-1-276"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-277"><a href="#__codelineno-1-277" id="__codelineno-1-277" name="__codelineno-1-277"></a><span class="s2">        """</span>
</span><span id="__span-1-278"><a href="#__codelineno-1-278" id="__codelineno-1-278" name="__codelineno-1-278"></a>
</span><span id="__span-1-279"><a href="#__codelineno-1-279" id="__codelineno-1-279" name="__codelineno-1-279"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-280"><a href="#__codelineno-1-280" id="__codelineno-1-280" name="__codelineno-1-280"></a><span class="c1"># STEPS 7-9: Conditional VQSR + always QC VariantFiltration</span>
</span><span id="__span-1-281"><a href="#__codelineno-1-281" id="__codelineno-1-281" name="__codelineno-1-281"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-282"><a href="#__codelineno-1-282" id="__codelineno-1-282" name="__codelineno-1-282"></a>rule<span class="w"> </span>vqsr_and_qc:
</span><span id="__span-1-283"><a href="#__codelineno-1-283" id="__codelineno-1-283" name="__codelineno-1-283"></a><span class="w">    </span>input:
</span><span id="__span-1-284"><a href="#__codelineno-1-284" id="__codelineno-1-284" name="__codelineno-1-284"></a><span class="w">        </span><span class="nv">raw</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.raw.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-285"><a href="#__codelineno-1-285" id="__codelineno-1-285" name="__codelineno-1-285"></a><span class="w">    </span>output:
</span><span id="__span-1-286"><a href="#__codelineno-1-286" id="__codelineno-1-286" name="__codelineno-1-286"></a><span class="w">        </span><span class="nv">qc</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.QC.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-287"><a href="#__codelineno-1-287" id="__codelineno-1-287" name="__codelineno-1-287"></a><span class="w">    </span>log:
</span><span id="__span-1-288"><a href="#__codelineno-1-288" id="__codelineno-1-288" name="__codelineno-1-288"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.07_vqsr_and_qc.log"</span><span class="o">)</span>
</span><span id="__span-1-289"><a href="#__codelineno-1-289" id="__codelineno-1-289" name="__codelineno-1-289"></a><span class="w">    </span>shell:
</span><span id="__span-1-290"><a href="#__codelineno-1-290" id="__codelineno-1-290" name="__codelineno-1-290"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-291"><a href="#__codelineno-1-291" id="__codelineno-1-291" name="__codelineno-1-291"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-292"><a href="#__codelineno-1-292" id="__codelineno-1-292" name="__codelineno-1-292"></a>
</span><span id="__span-1-293"><a href="#__codelineno-1-293" id="__codelineno-1-293" name="__codelineno-1-293"></a><span class="s2">        rawvcf={input.raw}</span>
</span><span id="__span-1-294"><a href="#__codelineno-1-294" id="__codelineno-1-294" name="__codelineno-1-294"></a><span class="s2">        tmp_vcf="</span><span class="nv">$rawvcf</span><span class="s2">"</span>
</span><span id="__span-1-295"><a href="#__codelineno-1-295" id="__codelineno-1-295" name="__codelineno-1-295"></a>
</span><span id="__span-1-296"><a href="#__codelineno-1-296" id="__codelineno-1-296" name="__codelineno-1-296"></a><span class="s2">        nSNP=</span><span class="k">$(</span>zgrep<span class="w"> </span>-v<span class="w"> </span><span class="s1">'^#'</span><span class="w"> </span><span class="s2">"</span><span class="nv">$rawvcf</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'length($5)==1'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="k">)</span>
</span><span id="__span-1-297"><a href="#__codelineno-1-297" id="__codelineno-1-297" name="__codelineno-1-297"></a><span class="s2">        nINDEL=</span><span class="k">$(</span>zgrep<span class="w"> </span>-v<span class="w"> </span><span class="s1">'^#'</span><span class="w"> </span><span class="s2">"</span><span class="nv">$rawvcf</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'length($5)!=1'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">' '</span><span class="k">)</span>
</span><span id="__span-1-298"><a href="#__codelineno-1-298" id="__codelineno-1-298" name="__codelineno-1-298"></a>
</span><span id="__span-1-299"><a href="#__codelineno-1-299" id="__codelineno-1-299" name="__codelineno-1-299"></a><span class="s2">        apply_snp=false</span>
</span><span id="__span-1-300"><a href="#__codelineno-1-300" id="__codelineno-1-300" name="__codelineno-1-300"></a><span class="s2">        apply_indel=false</span>
</span><span id="__span-1-301"><a href="#__codelineno-1-301" id="__codelineno-1-301" name="__codelineno-1-301"></a>
</span><span id="__span-1-302"><a href="#__codelineno-1-302" id="__codelineno-1-302" name="__codelineno-1-302"></a><span class="s2">        if [ "</span><span class="nv">$nSNP</span><span class="s2">" -ge "</span><span class="o">{</span>MIN_SNP_FOR_VQSR<span class="o">}</span><span class="s2">" ]; then</span>
</span><span id="__span-1-303"><a href="#__codelineno-1-303" id="__codelineno-1-303" name="__codelineno-1-303"></a><span class="s2">          {GATK4} VariantRecalibrator \</span>
</span><span id="__span-1-304"><a href="#__codelineno-1-304" id="__codelineno-1-304" name="__codelineno-1-304"></a><span class="s2">            -R {REF} \</span>
</span><span id="__span-1-305"><a href="#__codelineno-1-305" id="__codelineno-1-305" name="__codelineno-1-305"></a><span class="s2">            -V "</span><span class="nv">$rawvcf</span><span class="s2">" \</span>
</span><span id="__span-1-306"><a href="#__codelineno-1-306" id="__codelineno-1-306" name="__codelineno-1-306"></a><span class="s2">            {SNP_RES} \</span>
</span><span id="__span-1-307"><a href="#__codelineno-1-307" id="__codelineno-1-307" name="__codelineno-1-307"></a><span class="s2">            -an QD -an MQRankSum -an ReadPosRankSum -an FS -an MQ \</span>
</span><span id="__span-1-308"><a href="#__codelineno-1-308" id="__codelineno-1-308" name="__codelineno-1-308"></a><span class="s2">            --mode SNP \</span>
</span><span id="__span-1-309"><a href="#__codelineno-1-309" id="__codelineno-1-309" name="__codelineno-1-309"></a><span class="s2">            -O {VARCALLDIR}/{ID}.hc.snp.recal.vcf.gz \</span>
</span><span id="__span-1-310"><a href="#__codelineno-1-310" id="__codelineno-1-310" name="__codelineno-1-310"></a><span class="s2">            --tranches-file {VARCALLDIR}/{ID}.hc.snp.tranches.txt \</span>
</span><span id="__span-1-311"><a href="#__codelineno-1-311" id="__codelineno-1-311" name="__codelineno-1-311"></a><span class="s2">            --max-gaussians 6 \</span>
</span><span id="__span-1-312"><a href="#__codelineno-1-312" id="__codelineno-1-312" name="__codelineno-1-312"></a><span class="s2">            2&gt;&gt; {log}</span>
</span><span id="__span-1-313"><a href="#__codelineno-1-313" id="__codelineno-1-313" name="__codelineno-1-313"></a><span class="s2">          apply_snp=true</span>
</span><span id="__span-1-314"><a href="#__codelineno-1-314" id="__codelineno-1-314" name="__codelineno-1-314"></a><span class="s2">        fi</span>
</span><span id="__span-1-315"><a href="#__codelineno-1-315" id="__codelineno-1-315" name="__codelineno-1-315"></a>
</span><span id="__span-1-316"><a href="#__codelineno-1-316" id="__codelineno-1-316" name="__codelineno-1-316"></a><span class="s2">        if [ "</span><span class="nv">$nINDEL</span><span class="s2">" -ge "</span><span class="o">{</span>MIN_INDEL_FOR_VQSR<span class="o">}</span><span class="s2">" ]; then</span>
</span><span id="__span-1-317"><a href="#__codelineno-1-317" id="__codelineno-1-317" name="__codelineno-1-317"></a><span class="s2">          {GATK4} VariantRecalibrator \</span>
</span><span id="__span-1-318"><a href="#__codelineno-1-318" id="__codelineno-1-318" name="__codelineno-1-318"></a><span class="s2">            -R {REF} \</span>
</span><span id="__span-1-319"><a href="#__codelineno-1-319" id="__codelineno-1-319" name="__codelineno-1-319"></a><span class="s2">            -V "</span><span class="nv">$rawvcf</span><span class="s2">" \</span>
</span><span id="__span-1-320"><a href="#__codelineno-1-320" id="__codelineno-1-320" name="__codelineno-1-320"></a><span class="s2">            {INDEL_RES} \</span>
</span><span id="__span-1-321"><a href="#__codelineno-1-321" id="__codelineno-1-321" name="__codelineno-1-321"></a><span class="s2">            -an QD -an FS -an ReadPosRankSum \</span>
</span><span id="__span-1-322"><a href="#__codelineno-1-322" id="__codelineno-1-322" name="__codelineno-1-322"></a><span class="s2">            --mode INDEL \</span>
</span><span id="__span-1-323"><a href="#__codelineno-1-323" id="__codelineno-1-323" name="__codelineno-1-323"></a><span class="s2">            -O {VARCALLDIR}/{ID}.hc.indel.recal.vcf.gz \</span>
</span><span id="__span-1-324"><a href="#__codelineno-1-324" id="__codelineno-1-324" name="__codelineno-1-324"></a><span class="s2">            --tranches-file {VARCALLDIR}/{ID}.hc.indel.tranches.txt \</span>
</span><span id="__span-1-325"><a href="#__codelineno-1-325" id="__codelineno-1-325" name="__codelineno-1-325"></a><span class="s2">            --max-gaussians 4 \</span>
</span><span id="__span-1-326"><a href="#__codelineno-1-326" id="__codelineno-1-326" name="__codelineno-1-326"></a><span class="s2">            2&gt;&gt; {log}</span>
</span><span id="__span-1-327"><a href="#__codelineno-1-327" id="__codelineno-1-327" name="__codelineno-1-327"></a><span class="s2">          apply_indel=true</span>
</span><span id="__span-1-328"><a href="#__codelineno-1-328" id="__codelineno-1-328" name="__codelineno-1-328"></a><span class="s2">        fi</span>
</span><span id="__span-1-329"><a href="#__codelineno-1-329" id="__codelineno-1-329" name="__codelineno-1-329"></a>
</span><span id="__span-1-330"><a href="#__codelineno-1-330" id="__codelineno-1-330" name="__codelineno-1-330"></a><span class="s2">        if [ "</span><span class="nv">$apply_snp</span><span class="s2">" = true ]; then</span>
</span><span id="__span-1-331"><a href="#__codelineno-1-331" id="__codelineno-1-331" name="__codelineno-1-331"></a><span class="s2">          {GATK4} ApplyVQSR \</span>
</span><span id="__span-1-332"><a href="#__codelineno-1-332" id="__codelineno-1-332" name="__codelineno-1-332"></a><span class="s2">            -R {REF} -V "</span><span class="nv">$tmp_vcf</span><span class="s2">" \</span>
</span><span id="__span-1-333"><a href="#__codelineno-1-333" id="__codelineno-1-333" name="__codelineno-1-333"></a><span class="s2">            --recal-file {VARCALLDIR}/{ID}.hc.snp.recal.vcf.gz \</span>
</span><span id="__span-1-334"><a href="#__codelineno-1-334" id="__codelineno-1-334" name="__codelineno-1-334"></a><span class="s2">            --tranches-file {VARCALLDIR}/{ID}.hc.snp.tranches.txt \</span>
</span><span id="__span-1-335"><a href="#__codelineno-1-335" id="__codelineno-1-335" name="__codelineno-1-335"></a><span class="s2">            --mode SNP --truth-sensitivity-filter-level 99.0 \</span>
</span><span id="__span-1-336"><a href="#__codelineno-1-336" id="__codelineno-1-336" name="__codelineno-1-336"></a><span class="s2">            -O {VARCALLDIR}/{ID}.hc.post_snp.vcf.gz \</span>
</span><span id="__span-1-337"><a href="#__codelineno-1-337" id="__codelineno-1-337" name="__codelineno-1-337"></a><span class="s2">            2&gt;&gt; {log}</span>
</span><span id="__span-1-338"><a href="#__codelineno-1-338" id="__codelineno-1-338" name="__codelineno-1-338"></a><span class="s2">          tmp_vcf="</span><span class="o">{</span>VARCALLDIR<span class="o">}</span>/<span class="o">{</span>ID<span class="o">}</span>.hc.post_snp.vcf.gz<span class="s2">"</span>
</span><span id="__span-1-339"><a href="#__codelineno-1-339" id="__codelineno-1-339" name="__codelineno-1-339"></a><span class="s2">        fi</span>
</span><span id="__span-1-340"><a href="#__codelineno-1-340" id="__codelineno-1-340" name="__codelineno-1-340"></a>
</span><span id="__span-1-341"><a href="#__codelineno-1-341" id="__codelineno-1-341" name="__codelineno-1-341"></a><span class="s2">        if [ "</span><span class="nv">$apply_indel</span><span class="s2">" = true ]; then</span>
</span><span id="__span-1-342"><a href="#__codelineno-1-342" id="__codelineno-1-342" name="__codelineno-1-342"></a><span class="s2">          {GATK4} ApplyVQSR \</span>
</span><span id="__span-1-343"><a href="#__codelineno-1-343" id="__codelineno-1-343" name="__codelineno-1-343"></a><span class="s2">            -R {REF} -V "</span><span class="nv">$tmp_vcf</span><span class="s2">" \</span>
</span><span id="__span-1-344"><a href="#__codelineno-1-344" id="__codelineno-1-344" name="__codelineno-1-344"></a><span class="s2">            --recal-file {VARCALLDIR}/{ID}.hc.indel.recal.vcf.gz \</span>
</span><span id="__span-1-345"><a href="#__codelineno-1-345" id="__codelineno-1-345" name="__codelineno-1-345"></a><span class="s2">            --tranches-file {VARCALLDIR}/{ID}.hc.indel.tranches.txt \</span>
</span><span id="__span-1-346"><a href="#__codelineno-1-346" id="__codelineno-1-346" name="__codelineno-1-346"></a><span class="s2">            --mode INDEL --truth-sensitivity-filter-level 95.0 \</span>
</span><span id="__span-1-347"><a href="#__codelineno-1-347" id="__codelineno-1-347" name="__codelineno-1-347"></a><span class="s2">            -O {VARCALLDIR}/{ID}.hc.vqsr.vcf.gz \</span>
</span><span id="__span-1-348"><a href="#__codelineno-1-348" id="__codelineno-1-348" name="__codelineno-1-348"></a><span class="s2">            2&gt;&gt; {log}</span>
</span><span id="__span-1-349"><a href="#__codelineno-1-349" id="__codelineno-1-349" name="__codelineno-1-349"></a><span class="s2">          tmp_vcf="</span><span class="o">{</span>VARCALLDIR<span class="o">}</span>/<span class="o">{</span>ID<span class="o">}</span>.hc.vqsr.vcf.gz<span class="s2">"</span>
</span><span id="__span-1-350"><a href="#__codelineno-1-350" id="__codelineno-1-350" name="__codelineno-1-350"></a><span class="s2">        fi</span>
</span><span id="__span-1-351"><a href="#__codelineno-1-351" id="__codelineno-1-351" name="__codelineno-1-351"></a>
</span><span id="__span-1-352"><a href="#__codelineno-1-352" id="__codelineno-1-352" name="__codelineno-1-352"></a><span class="s2">        {GATK4} VariantFiltration \</span>
</span><span id="__span-1-353"><a href="#__codelineno-1-353" id="__codelineno-1-353" name="__codelineno-1-353"></a><span class="s2">          -R {REF} \</span>
</span><span id="__span-1-354"><a href="#__codelineno-1-354" id="__codelineno-1-354" name="__codelineno-1-354"></a><span class="s2">          -V "</span><span class="nv">$tmp_vcf</span><span class="s2">" \</span>
</span><span id="__span-1-355"><a href="#__codelineno-1-355" id="__codelineno-1-355" name="__codelineno-1-355"></a><span class="s2">          --filter-name "</span>LowQUAL<span class="s2">" --filter-expression "</span>QUAL<span class="w"> </span>&lt;<span class="w"> </span><span class="m">30</span>.0<span class="s2">" \</span>
</span><span id="__span-1-356"><a href="#__codelineno-1-356" id="__codelineno-1-356" name="__codelineno-1-356"></a><span class="s2">          --filter-name "</span>QD2<span class="s2">"        --filter-expression "</span>QD<span class="w"> </span>&lt;<span class="w"> </span><span class="m">2</span>.0<span class="s2">" \</span>
</span><span id="__span-1-357"><a href="#__codelineno-1-357" id="__codelineno-1-357" name="__codelineno-1-357"></a><span class="s2">          --filter-name "</span>FS60<span class="s2">"       --filter-expression "</span>FS<span class="w"> </span>&gt;<span class="w"> </span><span class="m">60</span>.0<span class="s2">" \</span>
</span><span id="__span-1-358"><a href="#__codelineno-1-358" id="__codelineno-1-358" name="__codelineno-1-358"></a><span class="s2">          --filter-name "</span>MQ40<span class="s2">"       --filter-expression "</span>MQ<span class="w"> </span>&lt;<span class="w"> </span><span class="m">40</span>.0<span class="s2">" \</span>
</span><span id="__span-1-359"><a href="#__codelineno-1-359" id="__codelineno-1-359" name="__codelineno-1-359"></a><span class="s2">          --filter-name "</span>MQRS-12.5<span class="s2">"  --filter-expression "</span>MQRankSum<span class="w"> </span>&lt;<span class="w"> </span>-12.5<span class="s2">" \</span>
</span><span id="__span-1-360"><a href="#__codelineno-1-360" id="__codelineno-1-360" name="__codelineno-1-360"></a><span class="s2">          --filter-name "</span>RPRS-8<span class="s2">"     --filter-expression "</span>ReadPosRankSum<span class="w"> </span>&lt;<span class="w"> </span>-8.0<span class="s2">" \</span>
</span><span id="__span-1-361"><a href="#__codelineno-1-361" id="__codelineno-1-361" name="__codelineno-1-361"></a><span class="s2">          --filter-name "</span>QD2_indel<span class="s2">"  --filter-expression "</span>QD<span class="w"> </span>&lt;<span class="w"> </span><span class="m">2</span>.0<span class="s2">" \</span>
</span><span id="__span-1-362"><a href="#__codelineno-1-362" id="__codelineno-1-362" name="__codelineno-1-362"></a><span class="s2">          --filter-name "</span>FS200<span class="s2">"      --filter-expression "</span>FS<span class="w"> </span>&gt;<span class="w"> </span><span class="m">200</span>.0<span class="s2">" \</span>
</span><span id="__span-1-363"><a href="#__codelineno-1-363" id="__codelineno-1-363" name="__codelineno-1-363"></a><span class="s2">          --filter-name "</span>RPRS-20<span class="s2">"    --filter-expression "</span>ReadPosRankSum<span class="w"> </span>&lt;<span class="w"> </span>-20.0<span class="s2">" \</span>
</span><span id="__span-1-364"><a href="#__codelineno-1-364" id="__codelineno-1-364" name="__codelineno-1-364"></a><span class="s2">          -O {output.qc} \</span>
</span><span id="__span-1-365"><a href="#__codelineno-1-365" id="__codelineno-1-365" name="__codelineno-1-365"></a><span class="s2">          2&gt;&gt; {log}</span>
</span><span id="__span-1-366"><a href="#__codelineno-1-366" id="__codelineno-1-366" name="__codelineno-1-366"></a><span class="s2">        """</span>
</span><span id="__span-1-367"><a href="#__codelineno-1-367" id="__codelineno-1-367" name="__codelineno-1-367"></a>
</span><span id="__span-1-368"><a href="#__codelineno-1-368" id="__codelineno-1-368" name="__codelineno-1-368"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-369"><a href="#__codelineno-1-369" id="__codelineno-1-369" name="__codelineno-1-369"></a><span class="c1"># STEP 10: Coverage</span>
</span><span id="__span-1-370"><a href="#__codelineno-1-370" id="__codelineno-1-370" name="__codelineno-1-370"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-371"><a href="#__codelineno-1-371" id="__codelineno-1-371" name="__codelineno-1-371"></a>rule<span class="w"> </span>coverage_stats:
</span><span id="__span-1-372"><a href="#__codelineno-1-372" id="__codelineno-1-372" name="__codelineno-1-372"></a><span class="w">    </span>input:
</span><span id="__span-1-373"><a href="#__codelineno-1-373" id="__codelineno-1-373" name="__codelineno-1-373"></a><span class="w">        </span><span class="nv">raw</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.bam"</span><span class="o">)</span>,
</span><span id="__span-1-374"><a href="#__codelineno-1-374" id="__codelineno-1-374" name="__codelineno-1-374"></a><span class="w">        </span><span class="nv">recal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>os.path.join<span class="o">(</span>BAMDIR,<span class="w"> </span>f<span class="s2">"{ID}.rg.merged.dedup.recal.bam"</span><span class="o">)</span>
</span><span id="__span-1-375"><a href="#__codelineno-1-375" id="__codelineno-1-375" name="__codelineno-1-375"></a><span class="w">    </span>output:
</span><span id="__span-1-376"><a href="#__codelineno-1-376" id="__codelineno-1-376" name="__codelineno-1-376"></a><span class="w">        </span><span class="nv">cov</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>os.path.join<span class="o">(</span>STATSDIR,<span class="w"> </span>f<span class="s2">"{ID}.coverage.txt"</span><span class="o">)</span>
</span><span id="__span-1-377"><a href="#__codelineno-1-377" id="__codelineno-1-377" name="__codelineno-1-377"></a><span class="w">    </span>log:
</span><span id="__span-1-378"><a href="#__codelineno-1-378" id="__codelineno-1-378" name="__codelineno-1-378"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.08_coverage_stats.log"</span><span class="o">)</span>
</span><span id="__span-1-379"><a href="#__codelineno-1-379" id="__codelineno-1-379" name="__codelineno-1-379"></a><span class="w">    </span>shell:
</span><span id="__span-1-380"><a href="#__codelineno-1-380" id="__codelineno-1-380" name="__codelineno-1-380"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-381"><a href="#__codelineno-1-381" id="__codelineno-1-381" name="__codelineno-1-381"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-382"><a href="#__codelineno-1-382" id="__codelineno-1-382" name="__codelineno-1-382"></a>
</span><span id="__span-1-383"><a href="#__codelineno-1-383" id="__codelineno-1-383" name="__codelineno-1-383"></a><span class="s2">        chrN="</span><span class="o">{</span>CHR1<span class="o">}</span><span class="s2">"</span>
</span><span id="__span-1-384"><a href="#__codelineno-1-384" id="__codelineno-1-384" name="__codelineno-1-384"></a><span class="s2">        bam_raw="</span><span class="o">{</span>input.raw<span class="o">}</span><span class="s2">"</span>
</span><span id="__span-1-385"><a href="#__codelineno-1-385" id="__codelineno-1-385" name="__codelineno-1-385"></a><span class="s2">        bam_recal="</span><span class="o">{</span>input.recal<span class="o">}</span><span class="s2">"</span>
</span><span id="__span-1-386"><a href="#__codelineno-1-386" id="__codelineno-1-386" name="__codelineno-1-386"></a>
</span><span id="__span-1-387"><a href="#__codelineno-1-387" id="__codelineno-1-387" name="__codelineno-1-387"></a><span class="s2">        out_raw="</span><span class="o">{</span>STATSDIR<span class="o">}</span>/<span class="o">{</span>CHR1<span class="o">}</span>.raw.bam<span class="s2">"</span>
</span><span id="__span-1-388"><a href="#__codelineno-1-388" id="__codelineno-1-388" name="__codelineno-1-388"></a><span class="s2">        out_dedup="</span><span class="o">{</span>STATSDIR<span class="o">}</span>/<span class="o">{</span>CHR1<span class="o">}</span>.dedup.bam<span class="s2">"</span>
</span><span id="__span-1-389"><a href="#__codelineno-1-389" id="__codelineno-1-389" name="__codelineno-1-389"></a>
</span><span id="__span-1-390"><a href="#__codelineno-1-390" id="__codelineno-1-390" name="__codelineno-1-390"></a><span class="s2">        {SAM} view -b "</span><span class="nv">$bam_raw</span><span class="s2">"   "</span><span class="nv">$chrN</span><span class="s2">" &gt; "</span><span class="nv">$out_raw</span><span class="s2">"   2&gt;&gt; {log}</span>
</span><span id="__span-1-391"><a href="#__codelineno-1-391" id="__codelineno-1-391" name="__codelineno-1-391"></a><span class="s2">        {SAM} view -b "</span><span class="nv">$bam_recal</span><span class="s2">" "</span><span class="nv">$chrN</span><span class="s2">" &gt; "</span><span class="nv">$out_dedup</span><span class="s2">" 2&gt;&gt; {log}</span>
</span><span id="__span-1-392"><a href="#__codelineno-1-392" id="__codelineno-1-392" name="__codelineno-1-392"></a>
</span><span id="__span-1-393"><a href="#__codelineno-1-393" id="__codelineno-1-393" name="__codelineno-1-393"></a><span class="s2">        {SAM} index "</span><span class="nv">$out_raw</span><span class="s2">"   2&gt;&gt; {log}</span>
</span><span id="__span-1-394"><a href="#__codelineno-1-394" id="__codelineno-1-394" name="__codelineno-1-394"></a><span class="s2">        {SAM} index "</span><span class="nv">$out_dedup</span><span class="s2">" 2&gt;&gt; {log}</span>
</span><span id="__span-1-395"><a href="#__codelineno-1-395" id="__codelineno-1-395" name="__codelineno-1-395"></a>
</span><span id="__span-1-396"><a href="#__codelineno-1-396" id="__codelineno-1-396" name="__codelineno-1-396"></a><span class="s2">        bash {COV} {ID} "</span><span class="nv">$out_raw</span><span class="s2">" "</span><span class="nv">$out_dedup</span><span class="s2">" {PIPELINE} \</span>
</span><span id="__span-1-397"><a href="#__codelineno-1-397" id="__codelineno-1-397" name="__codelineno-1-397"></a><span class="s2">          &gt; {output.cov} 2&gt;&gt; {log}</span>
</span><span id="__span-1-398"><a href="#__codelineno-1-398" id="__codelineno-1-398" name="__codelineno-1-398"></a>
</span><span id="__span-1-399"><a href="#__codelineno-1-399" id="__codelineno-1-399" name="__codelineno-1-399"></a><span class="s2">        rm -f "</span><span class="nv">$out_raw</span><span class="s2">" "</span><span class="nv">$out_dedup</span><span class="s2">" "</span><span class="nv">$out_raw</span>.bai<span class="s2">" "</span><span class="nv">$out_dedup</span>.bai<span class="s2">"</span>
</span><span id="__span-1-400"><a href="#__codelineno-1-400" id="__codelineno-1-400" name="__codelineno-1-400"></a><span class="s2">        """</span>
</span><span id="__span-1-401"><a href="#__codelineno-1-401" id="__codelineno-1-401" name="__codelineno-1-401"></a>
</span><span id="__span-1-402"><a href="#__codelineno-1-402" id="__codelineno-1-402" name="__codelineno-1-402"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-403"><a href="#__codelineno-1-403" id="__codelineno-1-403" name="__codelineno-1-403"></a><span class="c1"># STEP 10 cont: Sex</span>
</span><span id="__span-1-404"><a href="#__codelineno-1-404" id="__codelineno-1-404" name="__codelineno-1-404"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-405"><a href="#__codelineno-1-405" id="__codelineno-1-405" name="__codelineno-1-405"></a>rule<span class="w"> </span>sex_determination:
</span><span id="__span-1-406"><a href="#__codelineno-1-406" id="__codelineno-1-406" name="__codelineno-1-406"></a><span class="w">    </span>input:
</span><span id="__span-1-407"><a href="#__codelineno-1-407" id="__codelineno-1-407" name="__codelineno-1-407"></a><span class="w">        </span><span class="nv">qc</span><span class="o">=</span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.QC.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-408"><a href="#__codelineno-1-408" id="__codelineno-1-408" name="__codelineno-1-408"></a><span class="w">    </span>output:
</span><span id="__span-1-409"><a href="#__codelineno-1-409" id="__codelineno-1-409" name="__codelineno-1-409"></a><span class="w">        </span><span class="nv">sex</span><span class="o">=</span>os.path.join<span class="o">(</span>STATSDIR,<span class="w"> </span>f<span class="s2">"{ID}.sex.txt"</span><span class="o">)</span>
</span><span id="__span-1-410"><a href="#__codelineno-1-410" id="__codelineno-1-410" name="__codelineno-1-410"></a><span class="w">    </span>log:
</span><span id="__span-1-411"><a href="#__codelineno-1-411" id="__codelineno-1-411" name="__codelineno-1-411"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.09_sex_determination.log"</span><span class="o">)</span>
</span><span id="__span-1-412"><a href="#__codelineno-1-412" id="__codelineno-1-412" name="__codelineno-1-412"></a><span class="w">    </span>shell:
</span><span id="__span-1-413"><a href="#__codelineno-1-413" id="__codelineno-1-413" name="__codelineno-1-413"></a><span class="w">        </span>r<span class="s2">"""</span>
</span><span id="__span-1-414"><a href="#__codelineno-1-414" id="__codelineno-1-414" name="__codelineno-1-414"></a><span class="s2">        set -eu</span>
</span><span id="__span-1-415"><a href="#__codelineno-1-415" id="__codelineno-1-415" name="__codelineno-1-415"></a><span class="s2">        bash {VCF2SEX} {input.qc} &gt; {output.sex} 2&gt;&gt; {log}</span>
</span><span id="__span-1-416"><a href="#__codelineno-1-416" id="__codelineno-1-416" name="__codelineno-1-416"></a><span class="s2">        """</span>
</span><span id="__span-1-417"><a href="#__codelineno-1-417" id="__codelineno-1-417" name="__codelineno-1-417"></a>
</span><span id="__span-1-418"><a href="#__codelineno-1-418" id="__codelineno-1-418" name="__codelineno-1-418"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-419"><a href="#__codelineno-1-419" id="__codelineno-1-419" name="__codelineno-1-419"></a><span class="c1"># STEP 11: Optional cleanup</span>
</span><span id="__span-1-420"><a href="#__codelineno-1-420" id="__codelineno-1-420" name="__codelineno-1-420"></a><span class="c1"># -----------------------------</span>
</span><span id="__span-1-421"><a href="#__codelineno-1-421" id="__codelineno-1-421" name="__codelineno-1-421"></a>rule<span class="w"> </span>cleanup_bams:
</span><span id="__span-1-422"><a href="#__codelineno-1-422" id="__codelineno-1-422" name="__codelineno-1-422"></a><span class="w">    </span>input:
</span><span id="__span-1-423"><a href="#__codelineno-1-423" id="__codelineno-1-423" name="__codelineno-1-423"></a><span class="w">        </span>os.path.join<span class="o">(</span>VARCALLDIR,<span class="w"> </span>f<span class="s2">"{ID}.hc.QC.vcf.gz"</span><span class="o">)</span>
</span><span id="__span-1-424"><a href="#__codelineno-1-424" id="__codelineno-1-424" name="__codelineno-1-424"></a><span class="w">    </span>output:
</span><span id="__span-1-425"><a href="#__codelineno-1-425" id="__codelineno-1-425" name="__codelineno-1-425"></a><span class="w">        </span><span class="k">done</span><span class="o">=</span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.cleanup.done"</span><span class="o">)</span>
</span><span id="__span-1-426"><a href="#__codelineno-1-426" id="__codelineno-1-426" name="__codelineno-1-426"></a><span class="w">    </span>log:
</span><span id="__span-1-427"><a href="#__codelineno-1-427" id="__codelineno-1-427" name="__codelineno-1-427"></a><span class="w">        </span>os.path.join<span class="o">(</span>LOGDIR,<span class="w"> </span>f<span class="s2">"{ID}.10_cleanup_bams.log"</span><span class="o">)</span>
</span><span id="__span-1-428"><a href="#__codelineno-1-428" id="__codelineno-1-428" name="__codelineno-1-428"></a><span class="w">    </span>run:
</span><span id="__span-1-429"><a href="#__codelineno-1-429" id="__codelineno-1-429" name="__codelineno-1-429"></a><span class="w">        </span><span class="c1"># write any python errors to the log file</span>
</span><span id="__span-1-430"><a href="#__codelineno-1-430" id="__codelineno-1-430" name="__codelineno-1-430"></a><span class="w">        </span>try:
</span><span id="__span-1-431"><a href="#__codelineno-1-431" id="__codelineno-1-431" name="__codelineno-1-431"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>CLEANUP_BAM:
</span><span id="__span-1-432"><a href="#__codelineno-1-432" id="__codelineno-1-432" name="__codelineno-1-432"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span>pat<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span><span class="s2">"01_bam/*.bam"</span>,<span class="w"> </span><span class="s2">"01_bam/*.bai"</span><span class="o">)</span>:
</span><span id="__span-1-433"><a href="#__codelineno-1-433" id="__codelineno-1-433" name="__codelineno-1-433"></a><span class="w">                    </span><span class="k">for</span><span class="w"> </span>fp<span class="w"> </span><span class="k">in</span><span class="w"> </span>glob.glob<span class="o">(</span>pat<span class="o">)</span>:
</span><span id="__span-1-434"><a href="#__codelineno-1-434" id="__codelineno-1-434" name="__codelineno-1-434"></a><span class="w">                        </span>try:
</span><span id="__span-1-435"><a href="#__codelineno-1-435" id="__codelineno-1-435" name="__codelineno-1-435"></a><span class="w">                            </span>os.remove<span class="o">(</span>fp<span class="o">)</span>
</span><span id="__span-1-436"><a href="#__codelineno-1-436" id="__codelineno-1-436" name="__codelineno-1-436"></a><span class="w">                        </span>except<span class="w"> </span>FileNotFoundError:
</span><span id="__span-1-437"><a href="#__codelineno-1-437" id="__codelineno-1-437" name="__codelineno-1-437"></a><span class="w">                            </span>pass
</span><span id="__span-1-438"><a href="#__codelineno-1-438" id="__codelineno-1-438" name="__codelineno-1-438"></a><span class="w">            </span>Path<span class="o">(</span>output.done<span class="o">)</span>.write_text<span class="o">(</span><span class="s2">"ok\n"</span><span class="o">)</span>
</span><span id="__span-1-439"><a href="#__codelineno-1-439" id="__codelineno-1-439" name="__codelineno-1-439"></a><span class="w">        </span>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
</span><span id="__span-1-440"><a href="#__codelineno-1-440" id="__codelineno-1-440" name="__codelineno-1-440"></a><span class="w">            </span>Path<span class="o">(</span>log<span class="o">[</span><span class="m">0</span><span class="o">])</span>.write_text<span class="o">(</span>str<span class="o">(</span>e<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s2">"\n"</span><span class="o">)</span>
</span><span id="__span-1-441"><a href="#__codelineno-1-441" id="__codelineno-1-441" name="__codelineno-1-441"></a><span class="w">            </span>raise
</span></code></pre></div>
</details>
</div>
</div>
</input></input></div>
<hr/>
<h2 id="diagram-single-sample-weswgs-workflow">Diagram: Single-Sample WES/WGS Workflow<a class="headerlink" href="#diagram-single-sample-weswgs-workflow" title="Permanent link">¬∂</a></h2>
<div class="mermaid">flowchart TD
    A["Input FASTQ reads"]
    B["Align with BWA MEM and add read groups"]
    C["Merge lane BAM files"]
    D["Mark duplicates"]
    E["Base recalibration BQSR"]
    F["Run HaplotypeCaller to produce gVCF"]
    G["Run GenotypeGVCFs to produce raw VCF"]
    H["Check if enough variants for VQSR"]
    I["Build SNP VQSR model"]
    J["Build INDEL VQSR model"]
    K["Apply VQSR"]
    L["Apply hard filters"]
    M["Write final QC VCF"]
    N["Compute coverage and infer sex"]

    A --&gt; B --&gt; C --&gt; D --&gt; E --&gt; F --&gt; G --&gt; H
    H --&gt;|Yes| I --&gt; J --&gt; K --&gt; M
    H --&gt;|No| L --&gt; M
    M --&gt; N
</div>
<hr/>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">¬∂</a></h2>
<p>This pipeline processes <strong>one sample</strong> at a time and produces a high-quality, filtered VCF suitable for downstream analysis. It automatically adapts to:</p>
<ul>
<li><strong>WES</strong>: restricted to an exome interval list  </li>
<li><strong>WGS</strong>: whole genome (no interval restriction)</li>
</ul>
<hr/>
<h2 id="what-the-pipeline-does">What the Pipeline Does<a class="headerlink" href="#what-the-pipeline-does" title="Permanent link">¬∂</a></h2>
<h3 id="1-alignment-read-groups">1. Alignment &amp; Read Groups<a class="headerlink" href="#1-alignment-read-groups" title="Permanent link">¬∂</a></h3>
<ul>
<li>Align paired-end FASTQ files using <strong>BWA-MEM</strong>.</li>
<li>Add read groups (sample, library, lane, platform) required by GATK.</li>
<li>Output: lane-level BAMs with correct RG tags.</li>
</ul>
<h3 id="2-lane-merging">2. Lane Merging<a class="headerlink" href="#2-lane-merging" title="Permanent link">¬∂</a></h3>
<ul>
<li>Merge all lane BAMs for the same sample into a single BAM.</li>
<li>Ensures duplicate marking and BQSR operate on the full dataset.</li>
</ul>
<h3 id="3-duplicate-marking">3. Duplicate Marking<a class="headerlink" href="#3-duplicate-marking" title="Permanent link">¬∂</a></h3>
<ul>
<li>Use GATK <code>MarkDuplicates</code> on the merged BAM.</li>
<li>Flags PCR/optical duplicates to prevent them from inflating support for artefactual variants.</li>
</ul>
<h3 id="4-base-quality-score-recalibration-bqsr">4. Base Quality Score Recalibration (BQSR)<a class="headerlink" href="#4-base-quality-score-recalibration-bqsr" title="Permanent link">¬∂</a></h3>
<ul>
<li>Two-step process: <code>BaseRecalibrator</code> then <code>ApplyBQSR</code>.</li>
<li>Uses known variant databases (dbSNP, Mills, 1000G indels) to model and correct systematic base-quality errors.</li>
<li>Output: recalibrated BAM used for variant calling.</li>
</ul>
<h3 id="5-variant-calling-haplotypecaller-gvcf">5. Variant Calling (HaplotypeCaller, gVCF)<a class="headerlink" href="#5-variant-calling-haplotypecaller-gvcf" title="Permanent link">¬∂</a></h3>
<ul>
<li>Run GATK <code>HaplotypeCaller</code> in <strong>GVCF mode</strong> (<code>-ERC GVCF</code>).</li>
<li>WES: uses exome intervals; WGS: full genome.</li>
<li>Output: <code>&lt;id&gt;.hc.g.vcf.gz</code> (per-sample gVCF).</li>
</ul>
<h3 id="6-genotypegvcfs-raw-vcf">6. GenotypeGVCFs (Raw VCF)<a class="headerlink" href="#6-genotypegvcfs-raw-vcf" title="Permanent link">¬∂</a></h3>
<ul>
<li>Run GATK <code>GenotypeGVCFs</code> on the sample gVCF.</li>
<li>Output: <code>&lt;id&gt;.hc.raw.vcf.gz</code> (raw VCF with SNPs and indels).</li>
</ul>
<h3 id="7-variant-quality-score-recalibration-vqsr">7. Variant Quality Score Recalibration (VQSR)<a class="headerlink" href="#7-variant-quality-score-recalibration-vqsr" title="Permanent link">¬∂</a></h3>
<ul>
<li>If there are enough variants (SNPs and indels), build VQSR models:</li>
<li><code>VariantRecalibrator</code> for SNPs and indels separately.</li>
<li>Uses multiple annotations (QD, MQ, FS, MQRankSum, ReadPosRankSum).</li>
<li>Output: recalibration VCFs and tranche files.</li>
</ul>
<h3 id="8-apply-vqsr-or-hard-filters">8. Apply VQSR or Hard Filters<a class="headerlink" href="#8-apply-vqsr-or-hard-filters" title="Permanent link">¬∂</a></h3>
<ul>
<li>If models exist:</li>
<li>Apply SNP VQSR.</li>
<li>Then apply INDEL VQSR.</li>
<li>Output: <code>&lt;id&gt;.hc.vqsr.vcf.gz</code>.</li>
<li>If not:</li>
<li>Skip directly to hard filters on the raw VCF or post-SNP VQSR VCF.</li>
</ul>
<h3 id="9-generate-final-qc-vcf">9. Generate Final QC VCF<a class="headerlink" href="#9-generate-final-qc-vcf" title="Permanent link">¬∂</a></h3>
<ul>
<li>Run <code>VariantFiltration</code> with recommended hard filters on annotations.</li>
<li>Output: <code>&lt;id&gt;.hc.QC.vcf.gz</code> (final QC VCF).</li>
</ul>
<h3 id="10-coverage-sex-determination">10. Coverage &amp; Sex Determination<a class="headerlink" href="#10-coverage-sex-determination" title="Permanent link">¬∂</a></h3>
<ul>
<li>Extract chromosome 1 reads from raw and recalibrated BAMs.</li>
<li>Compute coverage statistics.</li>
<li>Infer sample sex from final VCF using a dedicated script.</li>
<li>Outputs:</li>
<li><code>03_stats/&lt;id&gt;.coverage.txt</code></li>
<li><code>03_stats/&lt;id&gt;.sex.txt</code></li>
</ul>
<hr/>
<h2 id="output-files">Output Files<a class="headerlink" href="#output-files" title="Permanent link">¬∂</a></h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>02_varcall/&lt;id&gt;.hc.g.vcf.gz</code></td>
<td>Per-sample gVCF (HaplotypeCaller)</td>
</tr>
<tr>
<td><code>02_varcall/&lt;id&gt;.hc.raw.vcf.gz</code></td>
<td>Raw VCF after GenotypeGVCFs</td>
</tr>
<tr>
<td><code>02_varcall/&lt;id&gt;.hc.vqsr.vcf.gz</code></td>
<td>VCF after VQSR (if VQSR was applied)</td>
</tr>
<tr>
<td><code>02_varcall/&lt;id&gt;.hc.QC.vcf.gz</code></td>
<td>Final QC-filtered VCF (recommended)</td>
</tr>
<tr>
<td><code>03_stats/&lt;id&gt;.coverage.txt</code></td>
<td>Coverage metrics</td>
</tr>
<tr>
<td><code>03_stats/&lt;id&gt;.sex.txt</code></td>
<td>Sex determination result</td>
</tr>
<tr>
<td><code>logs/&lt;id&gt;.log</code></td>
<td>Main pipeline log</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="when-to-use-this-pipeline">When to Use This Pipeline<a class="headerlink" href="#when-to-use-this-pipeline" title="Permanent link">¬∂</a></h2>
<ul>
<li>Standard clinical or research <strong>WES</strong> or <strong>WGS</strong> processing.</li>
<li>Generating gVCFs for <strong>cohort joint genotyping</strong>.</li>
<li>Producing high-quality single-sample VCFs for interpretation.</li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      ¬© Copyright 2024-2025, Manuel Rueda, CNAG
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/CNAG-Biomedical-Informatics" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.select", "content.code.copy", "content.tabs.link", "search.highlight", "search.share", "navigation.tracking", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
<script src="../../js/vendor/katex.js"></script>
<script src="../../js/theme_overrides.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({
    startOnLoad: true
});</script></body>
</html>